/*
JT808EditMap-2.4.0 code for exsun

Copyright©2015-2018 武汉依迅北斗空间技术有限公司 All Rights Reserved.

http://www.exsun.cn
*/




var jsFunc=function(){L.MapLib={},L.MapLib.MapMaster={},L.MapLib.MapMaster.vertion="0.0.1",L.MapLib.MapMaster.TileProvider={oTianDiTu:{oNormal:{cName:"天地图",cMap:"http://t{s}.tianditu.cn/DataServer?T=vec_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cva_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]},oSatellite:{cName:"天地卫星图",cMap:"http://t{s}.tianditu.cn/DataServer?T=img_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]},oTerrain:{cName:"天地地形图",cMap:"http://t{s}.tianditu.cn/DataServer?T=ter_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cta_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]}},oMapABC:{oNormal:{cName:"MapABC",cMap:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",acSubdomains:["a","b","c"]}},oGaoDe:{oNormal:{cName:"高德地图",cMap:"http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oSatellite:{cName:"高德卫星图",cMap:"http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oNetRoad:{cName:"高德路网图",cMap:"http://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]}},oExSun:{oNormal:{cName:"依迅地图",cMap:"http://title.comlbs.com/map/get/{x}/{y}/{z}",acSubdomains:["1","2","3","4"]},oNormalSvr:{cName:"依迅服务器图",cMap:"http://title.comlbs.com/mapimg.aspx?t=mapabc&z={z}&x={x}&y={y}",acSubdomains:["1","2","3","4"]}},oGoogleMap:{oNormal:{cName:"谷歌地图",cMap:"http://mt2.google.cn/vt/lyrs=m@167000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oSatellite:{cName:"谷歌卫星图",cMap:"http://mt3.google.cn/vt/lyrs=s&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oTopographic:{cName:"谷歌地形图",cMap:"http://mt0.google.cn/vt/lyrs=t&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",nMaxLevel:16,acSubdomains:["1","2","3","4"]}},oArcMap:{oFoursquare:{cMap:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",cName:"灰度图",acSubdomains:["1","2","3","4"]}},oTDMap:{oNormal:{cName:"立体图",cMap:"https://a.tiles.mapbox.com/v3/foursquare.map-0y1jh28j/{z}/{x}/{y}.png",acSubdomains:["1","2","3","4"]}}},L.MapLib.MapMaster.TileProvider[0]=L.MapLib.MapMaster.TileProvider.oTianDiTu.oNormal,L.MapLib.MapMaster.TileProvider[1]=L.MapLib.MapMaster.TileProvider.oTianDiTu.oSatellite,L.MapLib.MapMaster.TileProvider[2]=L.MapLib.MapMaster.TileProvider.oTianDiTu.oTerrain,L.MapLib.MapMaster.TileProvider[3]=L.MapLib.MapMaster.TileProvider.oMapABC.oNormal,L.MapLib.MapMaster.TileProvider[4]=L.MapLib.MapMaster.TileProvider.oGaoDe.oNormal,L.MapLib.MapMaster.TileProvider[5]=L.MapLib.MapMaster.TileProvider.oGaoDe.oSatellite,L.MapLib.MapMaster.TileProvider[6]=L.MapLib.MapMaster.TileProvider.oGaoDe.oNetRoad,L.MapLib.MapMaster.TileProvider[7]=L.MapLib.MapMaster.TileProvider.oExSun.oNormal,L.MapLib.MapMaster.TileProvider[8]=L.MapLib.MapMaster.TileProvider.oExSun.oNormalSvr,L.MapLib.MapMaster.TileProvider[9]=L.MapLib.MapMaster.TileProvider.oGoogleMap.oNormal,L.MapLib.MapMaster.TileProvider[10]=L.MapLib.MapMaster.TileProvider.oGoogleMap.oSatellite,L.MapLib.MapMaster.TileProvider[11]=L.MapLib.MapMaster.TileProvider.oGoogleMap.oTopographic,L.MapLib.MapMaster.TileProvider[12]=L.MapLib.MapMaster.TileProvider.oArcMap.oFoursquare,L.MapLib.MapMaster.TileProvider[13]=L.MapLib.MapMaster.TileProvider.oTDMap.oNormal,L.MapLib.MapMaster.Err={1:"没有设置图层！",2:"Map parent container not found."},L.MapLib.MapMaster.EventName={loadFinish:"Map:loadFinish"},L.MapLib.MapMaster.Map=L.Evented.extend({options:{cDidId:"divMap",cDivContainerId:"divContainer",nDefaultTile:4,oMapOption:{zoomControl:!1,layers:[],center:new L.LatLng(30.55072,114.29471),zoom:13},oTileOption:{maxZoom:18,minZoom:3,attribution:'Map &copy;GB-20263—2018 <a target="_blank" href="#">电子地图</a> '},anLoadTile:[4,5,6,9,10,11,12],oProvider:L.MapLib.MapMaster.TileProvider,nMapWidth:1200,nMapHeight:550},cDiv:"div",initialize:function(t,a){return L.setOptions(this,a),this._oParent=t,this._oBaseLayer={},this._oDefaultTile=void 0,this._initTile(),this._getDefaultLayer(),this},getDefaultTile:function(){var t=this.options.oProvider[this.options.nDefaultTile].cName;return this._oBaseLayer[t]},loadMapMaster:function(){return this._loadMap(),this},getMap:function(){return this._oMap},getBaseLayers:function(){if(!this._oBaseLayer)throw new Error("地图瓦片图层为空");return this._oBaseLayer},_getDefaultLayer:function(){var t=this.options.oProvider[this.options.nDefaultTile].cName;return this._oDefaultTile=this._oBaseLayer[t],this._oDefaultTile},_loadMap:function(){var t=L.DomUtil.get(this.options.cDidId),a=null,e=null;if(a=this.nMapWidth,e=this.nMapHeight,!t){var i=L.DomUtil.get(this.options.cDivContainerId);if(!i)throw new Error("不存在地图加载容器");t=L.DomUtil.create(this.cDiv,"",i)}t.style.width=a+"px",t.style.height=e+"px",t.id=this.options.cDidId,L.Util.extend(this.options.oMapOption,{layers:[this._oDefaultTile]});var o=this._oMap=new L.Map(this.options.cDidId,this.options.oMapOption);return this._oParent&&(this._oParent.setMap&&this._oParent.setMap(o),this.fire("Map:loadFinish",{oMap:o})),o},_initTile:function(){var t=L.extend({},this.options.oTileOption),a=this.options.oProvider,e=this.options.anLoadTile;if(e&&!(e.length<=0)&&a){for(var i={},o=0;o<e.length;o++){var n=a[e[o]];t.maxZoom=n.nMaxLevel||t.maxZoom,t.minZoom=n.nMinLevel||t.minZoom,t.subdomains=n.acSubdomains;var r=L.tileLayer(n.cMap,t);i[n.cName]=r}this._oBaseLayer=i,this._oParent,this.fire("Map:loadTileFinish",{oBaseLayer:i})}},reflesh:function(t,a){if(this._oMap){var e=this._oMap.getContainer();t&&(e.style.width=t+"px"),a&&(e.style.height=a+"px"),this._oMap._onResize()}}}),L.MapLib.MapMaster.Map.include({cTopLeftConfig:{div:{class:"ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left"}},cTopRightConfig:{div:{class:"ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left"}},initTopLeft:function(t){L.DomUtil.get(this.options.cDidId)},initTopRight:function(){}}),L.MapLib.MapEditControl=L.Evented.extend({options:{cParentDiv:"MapView",acParentDivClass:["ex-layout-maptool","ex-theme-maptool","ex-map-top","ex-map-left","ex-maptool-edit"],cBtnContain:".ex-map-tool-edit",className:"",title:"图层编辑",oPenStyle:{stroke:!0,color:"#0FFF05",dashArray:null,lineCap:null,lineJoin:null,weight:3,opacity:1,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1},oPenLineStyle:{stroke:!0,color:"#0FFF05",dashArray:null,lineCap:null,lineJoin:null,weight:3,opacity:1,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1}},initUI:function(){},initialize:function(t,a){L.extend(this,a),this.oPenStyle=this.options.oPenStyle,this.oPenLineStyle=this.options.oPenLineStyle,this._oMapBase=t.oMapMaster,this._oMap=t.oMapMaster._oMap,this._oParent=t,this._oDrawLayer=L.featureGroup(),this._oDrawLayer.addTo(this._oMap),this._oContainer=document.getElementById("railMap"),this.cFlag="add",this.setParentEvent(),this.initPen(),this.initUI(),this.initCallBack(),this.initOn()},initOn:function(){this._oParent.on("ESMapEdit:showEditDraw",this.showEditAdd,this),this._oParent.on("ESMapEdit:clearLayers",this.clearLayers,this),this._oParent.on("ESMapEdit:deleteFence",this.deleteFence,this),this._oParent.on("ESMapEdit:editDraw",this.editDraw,this),this._oParent.on("ESMap:removeMap",this.removeMap,this),this._oParent.on("editMap",this.editMap,this),this._oParent.on("disEditMap",this.disEditMap,this)},editMap:function(t){this.oEditPen.handler.enable()},disEditMap:function(t){this.oEditPen.handler.save(),this.oEditPen.handler.disable()},removeMap:function(t){this._oMap&&this._oMap.remove()},editDraw:function(t){this.cFlag="edit";for(var a=[],e=t.drawMapJson.aoLatLng,i=0;i<e.length;i++){var o=L.latLng(parseFloat(e[i].lat),parseFloat(e[i].lng));a.push(o)}if(2==t.type)var n=L.polyline(a,this.oPenLineStyle).addTo(this._oDrawLayer);else if(1==t.type)var n=L.marker([e[0].lat,[e[0].lng],this.oPenStyle]).addTo(this._oDrawLayer);else var n=L.polygon(a,this.oPenStyle).addTo(this._oDrawLayer);n.cId=t.Id,n.oFenceInfo=t,n.bindTooltip(t.name).openTooltip(),this.fitBound()},fitBound:function(){if(this._oDrawLayer){var t=this._oDrawLayer.getBounds();this._oMap.fitBounds(t)}},drawTip:function(t){var a={bIsNotEdit:!0,cName:"测试tip显示名称",oLatLng:{lat:30.333,lng:113.333},bNoHide:!0};L.extend(a,t);var e=new L.DivIcon({html:"<div> </div>",className:""}),i=L.marker(a.oLatLng,{icon:e,bIsNotEdit:a.bIsNotEdit});return i.cId=a.cId,i.bindLabel(a.cName,{noHide:a.bNoHide,direction:"auto"}),i},deleteFence:function(){this._oDrawLayer.clearLayers()},clearLayers:function(){this._oDrawLayer.clearLayers()},showEditAdd:function(){this.cFlag="add",this.show(),this.clearLayers(),this.liPlus.click()},show:function(){},hide:function(){},_drawType:function(t){var a=null;switch(t){case"polygon":a={enabled:{shapeOptions:this.oPenStyle},handler:new L.Draw.Polygon(this._oMap,{shapeOptions:this.oPenStyle}),title:L.drawLocal.draw.toolbar.buttons.polygon};break;case"polyline":a={enabled:{shapeOptions:this.oPenLineStyle},handler:new L.Draw.Polyline(this._oMap,{shapeOptions:this.oPenLineStyle}),title:L.drawLocal.draw.toolbar.buttons.polyline};break;case"marker":a={enabled:{shapeOptions:this.oPenStyle},handler:new L.Draw.Marker(this._oMap,{shapeOptions:this.oPenStyle}),title:L.drawLocal.draw.toolbar.buttons.marker}}return a},initPen:function(){this.oDrawPen=this._drawType(this._oParent.options.drawType),this.oEditPen={enabled:this.oPenStyle,handler:new L.EditToolbar.Edit(this._oMap,{featureGroup:this._oDrawLayer,selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1},poly:{allowIntersection:!1}}),title:L.drawLocal.edit.toolbar.buttons.edit}},setParentEvent:function(){},initCallBack:function(){var t=this;this._oMap.on("draw:edited",function(a){a.layers.eachLayer(function(a){var e=t._getGisObj(a);t._oDrawLayer.addLayer(a),e.cId=a.cId,e.oFenceInfo=a.oFenceInfo,t._oMapBase._oParent.dataFromJs=e})})},getDrawModeHandlers:function(){return[{enabled:this.options.polyline,handler:new L.Draw.Polyline(this._oMap,this.options.polyline),title:L.drawLocal.draw.toolbar.buttons.polyline},{enabled:{shapeOptions:this.oPenStyle},handler:new L.Draw.Polygon(this._oMap,{shapeOptions:this.oPenStyle}),title:L.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new L.Draw.Rectangle(this._oMap,this.options.rectangle),title:L.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new L.Draw.Circle(this._oMap,this.options.circle),title:L.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new L.Draw.Marker(this._oMap,this.options.marker),title:L.drawLocal.draw.toolbar.buttons.marker}]},getEditModeHandlers:function(){return[{enabled:this.oPenStyle,handler:new L.EditToolbar.Edit(this._oMap,{featureGroup:this._oDrawLayer,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:L.drawLocal.edit.toolbar.buttons.edit},{enabled:{},handler:new L.EditToolbar.Delete(this._oMap,{featureGroup:this._oDrawLayer}),title:L.drawLocal.edit.toolbar.buttons.remove}]},_getGisObj:function(t){var a={},e=t.options;if(t instanceof L.Circle){var i=t.getLatLng();a={aoLatLng:[i,L.latLng([i.lat+t._getLatRadius(),i.lng])],dRadius:t.getRadius(),oOption:e,nType:this.getObjType(t),centerPoint:t.getCenter()}}else a=t instanceof L.Marker?{aoLatLng:t.getLatLng(),oOption:e,nType:this.getObjType(t)}:{aoLatLng:t.getLatLngs(),oOption:e,nType:this.getObjType(t),centerPoint:t.getCenter()};return a},getObjType:function(t){return t instanceof L.Rectangle?3:t instanceof L.Polygon?1:t instanceof L.Polyline?4:t instanceof L.Circle?2:1},addFence:function(){}}),L.MapLib.MapMaster.PopMap=L.Evented.extend({options:{parentContainer:null,mapId:null},initialize:function(t,a){L.setOptions(this,a),this._oParent=t,a.parentContainer&&(this.initUI(),a.parentContainer.appendChild(this.mapPanel))},initUI:function(){this.mapPanel=L.DomUtil.create("div","ex-layout-map-content"),this.mapPanel.id=this.options.mapId,this.topLeftPanel=L.DomUtil.create("div","ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left",this.mapPanel),this.topRightPanel=L.DomUtil.create("div","ex-layout-maptool ex-theme-maptool ex-map-top ex-map-right",this.mapPanel),this.bottomLeftPanel=L.DomUtil.create("div","ex-layout-maptool ex-map-bottom ex-map-left",this.mapPanel),this.bottomRightPanel=L.DomUtil.create("div","ex-layout-maptool ex-theme-maptool ex-map-bottom ex-map-right",this.mapPanel)},loadMap:function(t,a){return this.oMapMaster=new L.MapLib.MapMaster.Map(this._oParent,{cDidId:this.options.mapId,oMapOption:{zoomControl:!1,layers:[],center:new L.LatLng(30.2215,114.2588),zoom:12}}),this.oMapMaster.nMapWidth=t,this.oMapMaster.nMapHeight=a,this.oMapMaster.loadMapMaster(),this.oMapMaster},resize:function(t,a){this.$_oContainer.width(t),this.$_oContainer.height(a),this.oMapMaster.reflesh(t,a)},loadMapToolArea:function(){this.oToolEdit=new L.MapLib.MapEditControl(this,{acParentDivClass:["ex-layout-maptool","ex-theme-maptool","ex-map-top","ex-map-right","ex-maptool-edit"]})}})}();