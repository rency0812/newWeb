/*
	ES.MapLib 2.4.0, a js library for exsun lbs instance.
	(c) 2016-2018, liulin
	武汉依迅
	http://www.exsun.cn/
*/

!function(t,e,i){i.MapLib={},i.MapLib.Version="0.2.4",i.MapLib={hide:function(t){t.style.display="none"},show:function(t){t.style.display="block"}},i.getData=function(t,e,i,a){var o=new XMLHttpRequest;o.open("POST",e,!0),o.setRequestHeader("Content-type","application/json"),o.onreadystatechange=function(){4!=o.readyState||200!=o.status&&304!=o.status||i.call(a,o.responseText)},o.send(t)},i.MapLib.Tooltip=i.Class.extend({initialize:function(t){this._map=t,this._popupPane=t._panes.popupPane;var e=i.DomUtil.create("div","leaflet-draw-tooltip",this._popupPane);this._container=e,this._singleLineLabel=!1,this._map.on("mouseout",this._onMouseOut,this)},dispose:function(){this._map.off("mouseout",this._onMouseOut,this),this._container&&(this._popupPane.removeChild(this._container),this._container=null)},updateContent:function(t){return this._container?(t.subtext=t.subtext||"",0!==t.subtext.length||this._singleLineLabel?t.subtext.length>0&&this._singleLineLabel&&(i.DomUtil.removeClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!1):(i.DomUtil.addClass(this._container,"leaflet-draw-tooltip-single"),this._singleLineLabel=!0),this._container.innerHTML=(t.subtext.length>0?'<span class="leaflet-draw-tooltip-subtext">'+t.subtext+"</span><br />":"")+"<span>"+t.text+"</span>",this):this},updatePosition:function(t){var e=this._map.latLngToLayerPoint(t),a=this._container;return this._container&&(a.style.visibility="inherit",i.DomUtil.setPosition(a,e)),this},showAsError:function(){return this._container&&i.DomUtil.addClass(this._container,"leaflet-error-draw-tooltip"),this},removeError:function(){return this._container&&i.DomUtil.removeClass(this._container,"leaflet-error-draw-tooltip"),this},_onMouseOut:function(){this._container&&(this._container.style.visibility="hidden")}}),i.GeometryUtil=i.extend(i.GeometryUtil||{},{geodesicAreaEx:function(t){var e,i,a=t.length,o=0,n=Math.PI/180;if(a>2){for(var s=0;a>s;s++)e=t[s],i=t[(s+1)%a],o+=(i.lng-e.lng)*n*(2+Math.sin(e.lat*n)+Math.sin(i.lat*n));o=6378137*o*6378137/2}return Math.abs(o)},readableAreaEx:function(t,e){var i;return e?i=t>=1e4?(1e-4*t).toFixed(2)+" 平方公顷":t.toFixed(2)+" 平方米":(t/=.836127,i=t>=3097600?(t/3097600).toFixed(2)+" mi&sup2;":t>=4840?(t/4840).toFixed(2)+" acres":Math.ceil(t)+" yd&sup2;"),i},readableDistanceEx:function(t,e,i){var a;if(e)a=t>1e3?(t/1e3).toFixed(2)+" 千米":Math.ceil(t)+" 米";else if(t*=1.09361,t>1760)a=(t/1760).toFixed(2)+" miles";else{var o=" yd";i&&(t=3*t,o=" ft"),a=Math.ceil(t)+o}return a}}),i.MapLib.Measure={},i.MapLib.Measure.version="2.4.0",i.MapLib.Measure.Msg={TipMarker:{setText:{beginText:"开始  "},createIcon:{closeText:"&times;"},addTotalPenal:{total:" 总共 "},setSubTotalDistTag:{total:" 共 "}},Dist:{_getTooltipText:{start:"点击开始测量距离.",cont:"点击继续测量距离.",end:"双击或者点击最后一个点结束测量."}},Area:{_getTooltipText:{start:"点击开始测量面积.",cont:"点击继续测量面积.",end:"双击或者点击第一个点结束测量."}},error:"<strong>错误:</strong> 线段不能相交!"},i.MapLib.Measure.DistMgr=i.Handler.extend({options:{},initialize:function(t,e){this._map=t,i.setOptions(this,e),this.aoMeasureHandker=[]},addHooks:function(){var t=i.MapLib.Measure.dist(this._map,this,this.options);this.oLastDist=t,this.aoMeasureHandker.push(t),t.createDist()},removeHooks:function(){this.oLastDist.removeDist()}}),i.MapLib.Measure.distMgr=function(t,e){return new i.MapLib.Measure.DistMgr(t,e)},i.MapLib.Measure.Dist=i.Class.extend({includes:i.Mixin.Events,statics:{TYPE:"DIST"},Poly:i.Polyline,options:{allowIntersection:!0,repeatMode:!1,drawError:{color:"#b00b00",timeout:2500},touchIcon:new i.DivIcon({iconSize:new i.Point(20,20),className:"leaflet-div-icon leaflet-editing-icon leaflet-touch-icon"}),guidelineDistance:20,maxGuideLineLength:4e3,shapeOptions:{stroke:!0,color:"#f06eaa",weight:2,opacity:1,fill:!1,clickable:!0},metric:!0,feet:!0,showLength:!0,bIsTotalDist:!0},initialize:function(t,e,a){i.Browser.touch&&(this.options.icon=this.options.touchIcon),this._oParent=e,this.options.drawError.message=i.MapLib.Measure.Msg.error,a&&a.drawError&&(a.drawError=i.Util.extend({},this.options.drawError,a.drawError)),this.type=i.MapLib.Measure.Dist.TYPE,this._map=t,this._container=t._container,this._overlayPane=t._panes.overlayPane,this._popupPane=t._panes.popupPane,a&&a.shapeOptions&&(a.shapeOptions=i.Util.extend({},this.options.shapeOptions,a.shapeOptions)),this._oLayerGroup=i.featureGroup().addTo(t),i.setOptions(this,a)},createDist:function(){this._map&&(i.DomUtil.disableTextSelection(),this._container.focus(),this._tooltip=new i.MapLib.Tooltip(this._map),i.DomEvent.on(this._container,"keyup",this._cancelDrawing,this),this._oMarkerMgr=new i.MapLib.Measure.MarkerMgr(this._map,this),this._oTipMarkerMgr=new i.MapLib.Measure.TipMarkerMgr(this._map,this,{metric:this.options.metric}),this._poly=new i.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this.initEvent())},initEvent:function(){this._mouseMarker||(this._mouseMarker=i.marker(this._map.getCenter(),{icon:i.divIcon({className:"leaflet-mouse-marker",iconAnchor:[20,20],iconSize:[40,40]}),opacity:0,zIndexOffset:this.options.zIndexOffset})),i.Browser.touch||this._map.on("mouseup",this._onMouseUp,this),this._mouseMarker.on("mousedown",this._onMouseDown,this).on("mouseout",this._onMouseOut,this).on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).addTo(this._map),this._map.on("mouseup",this._onMouseUp,this).on("mousemove",this._onMouseMove,this).on("zoomlevelschange",this._onZoomEnd,this).on("zoomend",this._onZoomEnd,this)},removeDist:function(){i.DomUtil.enableTextSelection(),this._tooltip.dispose(),this._tooltip=null,i.DomEvent.off(this._container,"keyup",this._cancelDrawing,this),this._clearHideErrorTimeout(),this._oMarkerMgr.cleanUpShape(),this._map.removeLayer(this._poly),delete this._poly,this._mouseMarker.off("mousedown",this._onMouseDown,this).off("mouseout",this._onMouseOut,this).off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this),this._map.removeLayer(this._mouseMarker),delete this._mouseMarker,this._clearGuides(),this._map.off("mouseup",this._onMouseUp,this).off("mousemove",this._onMouseMove,this).off("zoomlevelschange",this._onZoomEnd,this).off("zoomend",this._onZoomEnd,this)},deleteLastVertex:function(){if(!(this._markers.length<=1)){var t=this._markers.pop(),e=this._poly,i=this._poly.spliceLatLngs(e.getLatLngs().length-1,1)[0];this._markerGroup.removeLayer(t),e.getLatLngs().length<2&&this._map.removeLayer(e),this._vertexChanged(i,!1)}},addVertex:function(t){var e=this._oMarkerMgr.getLen();if(e>0&&!this.options.allowIntersection&&this._poly.newLatLngIntersects(t))return void this._showErrorTooltip();this._errorShown&&this._hideErrorTooltip();var i=this._oMarkerMgr.createMarker(t);this._oTipMarkerMgr.createMarker(t,i,{className:"rule_text_box",iconAnchor:[-10,20]}),this._poly.addLatLng(t),2===this._poly.getLatLngs().length&&this._map.addLayer(this._poly),this._vertexChanged(t,!0)},completeShape:function(){this._markers.length<=1||(this.removeDist(),this.options.repeatMode&&this._oParent.enable())},deleteHandler:function(t){if(this._oMarkerMgr&&!(this._oMarkerMgr.getLen()<=0)){this._oMarkerMgr.removeMarker(t);var e=this._oMarkerMgr.getPointMarkers();this._oRtnPoly&&this._oRtnPoly.setLatLngs(e)}},clearData:function(){!this._oMarkerMgr||this._oMarkerMgr.getLen()<=0||(this._oMarkerMgr.clearData(),this._oRtnPoly&&this._oRtnPoly.setLatLngs([]))},_finishShape:function(){var t=this._poly._defaultShape?this._poly._defaultShape():this._poly.getLatLngs(),e=this._poly.newLatLngIntersects(t[t.length-1]);return!this.options.allowIntersection&&e||!this._shapeIsValid()?void this._showErrorTooltip():(this._oTipMarkerMgr.addCloseBtn(),this._oRtnPoly=new this.Poly(this._poly.getLatLngs(),this.options.shapeOptions),this._oRtnPoly.addTo(this._oLayerGroup),this._oParent.disable(),this.options.bIsTotalDist&&this._oTipMarkerMgr.addTotalDist(),void(this.options.repeatMode&&this.enable()))},_shapeIsValid:function(){return!0},_onZoomEnd:function(){null!==this._markers&&this._updateGuide()},_onMouseMove:function(t){var e=this._map.mouseEventToLayerPoint(t.originalEvent),a=this._map.layerPointToLatLng(e);this._currentLatLng=a,this._updateTooltip(a),this._updateGuide(e),this._mouseMarker.setLatLng(a),i.DomEvent.preventDefault(t.originalEvent)},_vertexChanged:function(){this._map.fire("draw:drawvertex",{layers:this._markerGroup}),this._oMarkerMgr.updateFinishHandler(),this._clearGuides(),this._updateTooltip()},_onMouseDown:function(t){var e=t.originalEvent;this._mouseDownOrigin=i.point(e.clientX,e.clientY)},_onMouseUp:function(e){if(this._mouseDownOrigin){var a=i.point(e.originalEvent.clientX,e.originalEvent.clientY).distanceTo(this._mouseDownOrigin);Math.abs(a)<9*(t.devicePixelRatio||1)&&this.addVertex(e.latlng)}this._mouseDownOrigin=null},_onTouch:function(t){i.Browser.touch&&(this._onMouseDown(t),this._onMouseUp(t))},_onMouseOut:function(){this._tooltip&&this._tooltip._onMouseOut.call(this._tooltip)},_createMarker:function(t){var e=new i.Marker(t,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset});return this._markerGroup.addLayer(e),e},_updateGuide:function(t){var e=this._oMarkerMgr?this._oMarkerMgr.getLen():0;e>0&&(t=t||this._map.latLngToLayerPoint(this._currentLatLng),this._clearGuides(),this._drawGuide(this._map.latLngToLayerPoint(this._oMarkerMgr.getLastGeoPos()),t))},_updateTooltip:function(t){var e=this._getTooltipText();t&&this._tooltip.updatePosition(t),this._errorShown||this._tooltip.updateContent(e)},_drawGuide:function(t,e){var a,o,n,s=Math.floor(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))),r=this.options.guidelineDistance,l=this.options.maxGuideLineLength,h=s>l?s-l:r;for(this._guidesContainer||(this._guidesContainer=i.DomUtil.create("div","leaflet-draw-guides",this._overlayPane));s>h;h+=this.options.guidelineDistance)a=h/s,o={x:Math.floor(t.x*(1-a)+a*e.x),y:Math.floor(t.y*(1-a)+a*e.y)},n=i.DomUtil.create("div","leaflet-draw-guide-dash",this._guidesContainer),n.style.backgroundColor=this._errorShown?this.options.drawError.color:this.options.shapeOptions.color,i.DomUtil.setPosition(n,o)},_updateGuideColor:function(t){if(this._guidesContainer)for(var e=0,i=this._guidesContainer.childNodes.length;i>e;e++)this._guidesContainer.childNodes[e].style.backgroundColor=t},_clearGuides:function(){if(this._guidesContainer)for(;this._guidesContainer.firstChild;)this._guidesContainer.removeChild(this._guidesContainer.firstChild)},_getTooltipText:function(){var t,e,a=this.options.showLength,o=this._oMarkerMgr.getLen();return 0===o?t={text:i.MapLib.Measure.Msg.Dist._getTooltipText.start}:(e=a?this._getMeasurementString():"",t=1===o?{text:i.MapLib.Measure.Msg.Dist._getTooltipText.cont,subtext:e}:{text:i.MapLib.Measure.Msg.Dist._getTooltipText.end,subtext:e}),t},_getMeasurementString:function(){var t,e=this._currentLatLng,a=this._oMarkerMgr.getLastGeoPos();return t=this._oTipMarkerMgr.getTotalDist()+e.distanceTo(a),i.GeometryUtil.readableDistance(t,this.options.metric,this.options.feet)},_showErrorTooltip:function(){this._errorShown=!0,this._tooltip.showAsError().updateContent({text:this.options.drawError.message}),this._updateGuideColor(this.options.drawError.color),this._poly.setStyle({color:this.options.drawError.color}),this._clearHideErrorTimeout(),this._hideErrorTimeout=setTimeout(i.Util.bind(this._hideErrorTooltip,this),this.options.drawError.timeout)},_hideErrorTooltip:function(){this._errorShown=!1,this._clearHideErrorTimeout(),this._tooltip.removeError().updateContent(this._getTooltipText()),this._updateGuideColor(this.options.shapeOptions.color),this._poly.setStyle({color:this.options.shapeOptions.color})},_clearHideErrorTimeout:function(){this._hideErrorTimeout&&(clearTimeout(this._hideErrorTimeout),this._hideErrorTimeout=null)},_cancelDrawing:function(t){this._map.fire("draw:canceled",{layerType:this.type}),27===t.keyCode&&this._oParent.disable()}}),i.MapLib.Measure.dist=function(t,e){return new i.MapLib.Measure.Dist(t,e)},i.MapLib.Measure.MarkerMgr=i.Class.extend({statics:{TYPE:"DIST"},options:{icon:new i.DivIcon({iconSize:new i.Point(8,8),className:"leaflet-div-icon leaflet-editing-icon"}),zIndexOffset:2e3},initialize:function(t,e,a){this._map=t,this._oParent=e,i.setOptions(this,a),this._dTotalDist=0,this._markers=[],this._layerGroup=i.featureGroup(),this._map.addLayer(this._layerGroup)},createMarker:function(t,e){var a=i.extend({},e,{icon:this.options.icon,zIndexOffset:2*this.options.zIndexOffset}),o=new i.Marker(t,a);return this._layerGroup.addLayer(o),this._markers.push(o),o},getLen:function(){return this._markers?this._markers.length:0},getLastMarker:function(){return!this._markers||this._markers.length<=0?null:this._markers[this._markers.length-1]},getLastGeoPos:function(){var t=this.getLastMarker();return t.getLatLng()},getPointMarkers:function(){var t=[];if(!this._markers||this._markers.length<=0)return t;for(var e=0;e<this._markers.length;e++)t.push(this._markers[e].getLatLng());return t},updateFinishHandler:function(){var t=this._markers.length;t>1&&(this._markers[t-1].on("click",this._finishShape,this),this._markers[t-1].on("dblclick",this._finishShape,this)),t>2&&(this._markers[t-2].off("click",this._finishShape,this),this._markers[t-2].on("dblclick",this._finishShape,this))},cleanUpShape:function(){this._markers<=1||this.getLastMarker().off("click",this._finishShape,this)},_finishShape:function(){this._oParent._finishShape()},removeMarker:function(t){for(var e=this._markers.length-1;e>=0;e--)if(this._markers[e]===t){this._markers.splice(e,1);break}this._layerGroup.removeLayer(t)},updateDist:function(){for(var t=0;t<this._markers;t++)if(0!==t){var e=this._tipMarkers[t].getLatLng().distanceTo(this._tipMarkers[t-1]);this._tipMarkers[t].setDist(e)}else this._tipMarkers[t].setDist(0)},clearData:function(){this._markers.splice(0,this._markers.length),this._layerGroup.clearLayers()},remove:function(){this._map.removeLayer(this._layerGroup),delete this._layerGroup,delete this._markers}}),i.MapLib.Measure.TipMarkerMgr=i.Class.extend({statics:{TYPE:"DIST"},initialize:function(t,e,a){this._map=t,i.setOptions(this,a),this._markers=[],this._layerGroup=i.featureGroup(),this._map.addLayer(this._layerGroup),this._oParent=e},options:{metric:!0},createMarker:function(t,e,a){var o=i.MapLib.Measure.tipMarker(t,this,a);o.addTo(this._layerGroup),this._markers.push(o);var n=this.getSecLastMarker(),s=this.calDist(o,n);return o.setDist(s),1===this._markers.length&&o.setBeginText(),this._markers.length>1&&(s=this.getTotalDist(),o.setSubTotalDist(s)),e&&(o.oRelaMarker=e),o},calDist:function(t,e){if(!e)return 0;var i=t.getLatLng(),a=e.getLatLng();return i.distanceTo(a)},getTotalDist:function(){if(this._markers.length<=0)return 0;for(var t=0,e=0;e<this._markers.length;e++)t+=this._markers[e].dDist;return t},getLastMarker:function(){return!this._markers||this._markers.length<=0?null:this._markers[this.getLen()-1]},getLastGeoPos:function(){var t=this.getLastMarker();return t.getLatLng()},getSecLastMarker:function(){return!this._markers||this._markers.length<=1?null:this._markers[this.getLen()-2]},getLen:function(){return this._markers?this._markers.length:0},addCloseBtn:function(){var t=this.getLastMarker();t&&t.addAllClose()},addTotalDist:function(){var t=this.getLastMarker();if(t){var e=this.getTotalDist();t.addTotalPenal(e)}},setTipTotalDist:function(){var t=this.getLastMarker();if(t){var e=this.getTotalDist();t.setTotalDist(e)}},setSubDist:function(){if(this._markers&&!(this._markers.length<=0)){this._markers[0].setDist(0),this._markers[0].deleteSubTotalTag();for(var t=1;t<this._markers.length;t++){var e=this.calDist(this._markers[t],this._markers[t-1]);this._markers[t].setDist(e)}}},setTipSubTotalDist:function(){if(this._markers&&!(this._markers.length<=0))for(var t=0,e=1;e<this._markers.length;e++)t=this._markers[e].dDist+t,this._markers[e].setSubTotalDist(t)},update:function(){this.setSubDist(),this.setTipSubTotalDist(),this._oParent.options.bIsTotalDist?this.addTotalDist():this.setTipTotalDist(),this.addCloseBtn()},removeTipMarker:function(t){if(2===this._markers.length)return this.clearData(),void this._oParent.clearData();for(var e=this._markers.length-1;e>=0;e--)if(this._markers[e]===t){this._markers.splice(e,1);break}this.update(),t.oRelaMarker&&this._oParent.deleteHandler(t.oRelaMarker),this._layerGroup.removeLayer(t)},clearData:function(){this._markers.splice(0,this._markers.length),this._layerGroup.clearLayers()},deleteDist:function(){this.clearData(),this._oParent.clearData()},remove:function(){this._map.removeLayer(this._layerGroup),delete this._layerGroup,delete this._markers}}),i.MapLib.Measure.TipMarker=i.Marker.extend({options:{oShowConfig:{bIsSubDist:!1,bIsSubTotalDist:!0,bIsSubClose:!0},metric:!0},oUIConfig:{oSubBeginTxt:{nOrder:1,cTagName:"span"},oSubDist:{nOrder:2,cTagName:"span"},oSubTotalDist:{nOrder:3,cTagName:"span"},oTotalDist:{nOrder:4,cTagName:"span"},oSubClose:{nOrder:5,cTagName:"a",cClassName:"ex-dist-subclose ec-text-lg",cText:"",cHtml:i.MapLib.Measure.Msg.TipMarker.createIcon.closeText,bIsClick:!0},oTotalClose:{nOrder:6,cTagName:"a",cClassName:"ex-dist-close ec-icon-trash",cText:"",cHtml:""}},initialize:function(t,e,a){i.Util.extend(this.oUIConfig,a.oUIConfig);for(var o in this.oUIConfig)"span"===this.oUIConfig[o].cTagName&&(this.oUIConfig[o].metric=this.options.metric);i.Marker.prototype.initialize.call(this,t,a),this._oParent=e,this.aoTag=[]},_initIcon:function(){var t=this.options,e=this._map,a=e.options.zoomAnimation&&e.options.markerZoomAnimation,o=a?"leaflet-zoom-animated":"leaflet-zoom-hide",n=this.createIcon();i.DomUtil.addClass(n,o),t.keyboard&&(n.tabIndex="0"),this._icon=n,this._initInteraction(),t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),t.opacity<1&&this._updateOpacity();var s=this._map._panes;s.markerPane.appendChild(this._icon)},_setIconStyles:function(t,e){var a,o=this.options,n=i.point(o[e+"Size"]);a=i.point(o.iconAnchor),!a&&n&&(a=n.divideBy(2,!0)),t.className="leaflet-marker-"+e+" "+o.className,a&&(t.style.marginLeft=-a.x+"px",t.style.marginTop=-a.y+"px"),n&&(t.style.width=n.x+"px",t.style.height=n.y+"px")},createIcon:function(){var t=i.DomUtil.create("div","");return this._setIconStyles(t,"icon"),this.oTagContanier=t,this.createTag(),t},createTag:function(){var t=this.options.oShowConfig;for(var e in t)if(t[e]){var a=e.replace("bIs","o");if(this.oUIConfig.hasOwnProperty(a)){var o=new i.MapLib.Measure.TipTag(this,this.oUIConfig[a]);o.setFlag(a),this.addTag(o),this.oUIConfig[a].bIsClick&&o.setClick(this.closeHanler,this)}}},addTag:function(t){var e=this.aoTag;if(e.length<=0)return e.push(t),void this.oTagContanier.appendChild(t.oTag);for(var i=e.length,a=0;a<e.length;a++)if(t.nOrder<e[a].nOrder){i=a;break}i===e.length?(this.oTagContanier.appendChild(t.oTag),this.aoTag.push(t)):(this.oTagContanier.insertBefore(t.oTag,this.aoTag[i].oTag),this.aoTag.splice(i,0,t))},addAllClose:function(){var t=this.getTagByFlag("oTotalClose");t||(t=i.MapLib.Measure.tipTag(this,this.oUIConfig.oTotalClose),t.setFlag("oTotalClose"),this.addTag(t),t.setClick(function(){this._oParent.deleteDist()},this))},deleteTag:function(t){var e=this.aoTag;if(e&&!(e.length<=0))for(var i=0;i<e.length;i++)if(e[i].cFlag===t){this.oTagContanier.removeChild(e[i].oTag),e.splice(i,1);break}},deleteSubTotalTag:function(){this.deleteTag("oSubTotalDist")},addTotalPenal:function(t){var e=this.getTagByFlag("oTotalDist");e||(e=i.MapLib.Measure.tipTag(this,this.oUIConfig.oTotalDist),e.setFlag("oTotalDist"),this.addTag(e)),this.setTotalDist(t,e)},setTotalDist:function(t,e){if(e||(e=this.getTagByFlag("oTotalDist")),e){this.deleteTag("oSubTotalDist");var a=i.MapLib.Measure.Msg.TipMarker.addTotalPenal.total;e.setHTML(t,a)}},setDist:function(t){this.dDist=t;var e=this.getTagByFlag("oSubDist");e&&e.setHTML(t)},setBeginText:function(){var t="oSubBeginTxt",e=new i.MapLib.Measure.TipTag(this,this.oUIConfig[t]);e.setFlag(t),this.addTag(e);var a=i.MapLib.Measure.Msg.TipMarker.setText.beginText;e.setHTML(a)},getTagByFlag:function(t){var e=this.aoTag;if(!e||e.length<=0)return void 0;for(var i=0;i<e.length;i++)if(e[i].cFlag===t)return e[i];return void 0},setSubTotalDist:function(t){var e=this.getTagByFlag("oSubTotalDist");if(e){var a=i.MapLib.Measure.Msg.TipMarker.setSubTotalDistTag.total;e.setHTML(t,a)}},closeHanler:function(){this._oParent.removeTipMarker(this)}}),i.MapLib.Measure.tipMarker=function(t,e,a){return new i.MapLib.Measure.TipMarker(t,e,a)},i.MapLib.Measure.TipTag=i.Class.extend({options:{cTagName:"span",cClassName:"",nOrder:1,cText:""},initialize:function(t,e){i.setOptions(this,e),this._oParent=t,this.createTag()},createTag:function(){var t=i.DomUtil.create(this.options.cTagName,"");return this.nOrder=this.options.nOrder,this.options.cClassName&&i.DomUtil.addClass(t,this.options.cClassName),t.text=this.options.cText,t.innerHTML=this.options.cHtml||"",this.oTag=t,t},setFlag:function(t){this.cFlag=t,this.oTag.setAttribute("cFlag",t)},setHTML:function(t,e){if("string"==typeof t)return void(this.oTag.innerText=t);var a="";0!==t&&(a=i.GeometryUtil.readableDistance(t,!0)),this.oTag.innerHTML=(e||"")+a},setClick:function(t,e){i.DomEvent.on(this.oTag,"click",t,e)}}),i.MapLib.Measure.tipTag=function(t,e){return new i.MapLib.Measure.TipTag(t,e)},i.MapLib.Measure.AreaMgr=i.MapLib.Measure.DistMgr.extend({addHooks:function(){var t=i.MapLib.Measure.area(this._map,this,this.options);this.oLastDist=t,this.aoMeasureHandker.push(t),t.createDist()}}),i.MapLib.Measure.areaMgr=function(t,e){return new i.MapLib.Measure.AreaMgr(t,e)},i.MapLib.Measure.Area=i.MapLib.Measure.Dist.extend({statics:{TYPE:"area"},Poly:i.Polygon,options:{showArea:!1,shapeOptions:{stroke:!0,color:"#f06eaa",weight:2,opacity:1,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0},metric:!0},initialize:function(t,e,a){i.MapLib.Measure.Dist.prototype.initialize.call(this,t,e,a),this.type=i.MapLib.Measure.Area.TYPE},createDist:function(){this._map&&(i.DomUtil.disableTextSelection(),this._container.focus(),this._tooltip=new i.MapLib.Tooltip(this._map),i.DomEvent.on(this._container,"keyup",this._cancelDrawing,this),this._oMarkerMgr=new i.MapLib.Measure.AreaMarkerMgr(this._map,this),this._oTipMarkerMgr=new i.MapLib.Measure.AreaTipMarkerMgr(this._map,this),this._poly=new i.Polyline([],this.options.shapeOptions),this._tooltip.updateContent(this._getTooltipText()),this.initEvent())},_getTooltipText:function(){var t,e,a=this._oMarkerMgr.getLen();return 0===a?t=i.MapLib.Measure.Msg.Area._getTooltipText.start:3>a?t=i.MapLib.Measure.Msg.Area._getTooltipText.cont:(t=i.MapLib.Measure.Msg.Area._getTooltipText.end,e=this._getMeasurementString()),{text:t,subtext:e}},_getMeasurementString:function(){var t=this._area;return t?i.GeometryUtil.readableArea(t,this.options.metric):null},_shapeIsValid:function(){var t=this._oMarkerMgr.getLen();return t>=3},_vertexChanged:function(t,e){var a;!this.options.allowIntersection&&this.options.showArea&&(a=this._poly.getLatLngs(),this._area=i.GeometryUtil.geodesicArea(a)),i.MapLib.Measure.Dist.prototype._vertexChanged.call(this,t,e)},_cleanUpShape:function(){var t=this._markers.length;t>0&&(this._markers[0].off("click",this._finishShape,this),t>2&&this._markers[t-1].off("dblclick",this._finishShape,this))}}),i.MapLib.Measure.area=function(t,e,a){return new i.MapLib.Measure.Area(t,e,a)},i.MapLib.Measure.AreaMarkerMgr=i.MapLib.Measure.MarkerMgr.extend({updateFinishHandler:function(){var t=this._markers.length;1===t&&this._markers[0].on("click",this._finishShape,this),t>2&&(this._markers[t-1].on("dblclick",this._finishShape,this),t>3&&this._markers[t-2].off("dblclick",this._finishShape,this))}}),i.MapLib.Measure.AreaTipMarkerMgr=i.MapLib.Measure.TipMarkerMgr.extend({statics:{TYPE:"AREA"},createMarker:function(t,e,a){var o=new i.MapLib.Measure.AreaTipMarker(t,this,a);return o.addTo(this._layerGroup),this._markers.push(o),e&&(o.oRelaMarker=e),o},getTotalDist:function(){if(this._markers.length<=2)return 0;var t=this._markers.map(function(t){return t.getLatLng()}),e=i.GeometryUtil.geodesicArea(t);return e},removeTipMarker:function(t){if(3===this._markers.length)return this.clearData(),void this._oParent.clearData();for(var e=this._markers.length-1;e>=0;e--)if(this._markers[e]===t){this._markers.splice(e,1);break}this.update(),t.oRelaMarker&&this._oParent.deleteHandler(t.oRelaMarker),this._layerGroup.removeLayer(t)},update:function(){this._oParent.options.bIsTotalDist?this.addTotalDist():this.setTipTotalDist(),this.addCloseBtn()}}),i.MapLib.Measure.AreaTipMarker=i.MapLib.Measure.TipMarker.extend({options:{oShowConfig:{bIsSubDist:!1,bIsSubClose:!0},metric:!0},oUIConfig:{oTotalDist:{nOrder:3,cTagName:"span"},oSubClose:{nOrder:4,cTagName:"a",cClassName:"ex-dist-subclose ec-text-lg",cText:"",cHtml:i.MapLib.Measure.Msg.TipMarker.createIcon.closeText,bIsClick:!0},oTotalClose:{nOrder:5,cTagName:"a",cClassName:"ex-dist-close ec-icon-trash",cText:"",cHtml:""}},createTag:function(){var t=this.options.oShowConfig;for(var e in t)if(t[e]){var a=e.replace("bIs","o");if(this.oUIConfig.hasOwnProperty(a)){var o=new i.MapLib.Measure.AreaTipTag(this,this.oUIConfig[a]);o.setFlag(a),this.addTag(o),this.oUIConfig[a].bIsClick&&o.setClick(this.closeHanler,this)}}},addTotalPenal:function(t){var e=this.getTagByFlag("oTotalDist");e||(e=new i.MapLib.Measure.AreaTipTag(this,this.oUIConfig.oTotalDist),e.setFlag("oTotalDist"),this.addTag(e)),this.setTotalDist(t,e)}}),i.MapLib.Measure.AreaTipTag=i.MapLib.Measure.TipTag.extend({setHTML:function(t){if("string"==typeof t)return void(this.oTag.innerText=t);var e=i.MapLib.Measure.Msg.TipMarker.setText.beginText;0!==t&&(e=i.GeometryUtil.readableAreaEx(t,this.options.metric)),this.oTag.innerHTML=e}}),i.MapLib.LocaltionSearch={},i.MapLib.LocaltionSearch.version="2.4.0",i.MapLib.LocaltionSearch.Msg={addHooks:{locText:"move mouse to search localtion"},_onMouseMove:{locTemp:"lng:{lng},lat:{lat}"}},i.MapLib.LocaltionSearch.Search=i.Handler.extend({statics:{TYPE:"LocaltionSearch"},includes:i.Mixin.Events,initialize:function(t,e){i.Handler.prototype.initialize.call(this,t),i.setOptions(this,e),this._uneditedLayerProps={}},enable:function(){this._enabled||(this.fire("enabled",{handler:this.type}),this._map.fire("tool:localStart",{handler:this.type}),i.Handler.prototype.enable.call(this))},disable:function(){this._enabled&&(i.Handler.prototype.disable.call(this),this._map.fire("tool:localStop",{handler:this.type}),this.fire("disabled",{handler:this.type}))},addHooks:function(){var t=this._map;t&&(t.getContainer().focus(),this._tooltip=new i.MapLib.Tooltip(this._map),this._tooltip.updateContent({text:"",subtext:i.MapLib.LocaltionSearch.Msg.addHooks.locText}),i.DomUtil.addClass(this._map.getContainer(),"toopTipClass"),this._map.on("mousemove",this._onMouseMove,this).on("click",this._onClick,this))},removeHooks:function(){this._map&&(this._uneditedLayerProps={},this._tooltip.dispose(),this._tooltip=null,i.DomUtil.removeClass(this._map.getContainer(),"toopTipClass"),this._map.off("mousemove",this._onMouseMove,this).off("click",this._onClick,this))},_onClick:function(t){var a=this._map.getContainer(),o=i.DomUtil.create("input","",a);o.type="text";var n={lat:t.latlng.lat.toFixed(6),lng:t.latlng.lng.toFixed(6)};o.value=i.Util.template(i.MapLib.LocaltionSearch.Msg._onMouseMove.locTemp,n),o.select(),e.execCommand("Copy"),a.removeChild(o),this.disable()},_onMouseMove:function(t){var e={lat:t.latlng.lat.toFixed(6),lng:t.latlng.lng.toFixed(6)};this._tooltip.updateContent({text:i.MapLib.LocaltionSearch.Msg.addHooks.locText,subtext:i.Util.template(i.MapLib.LocaltionSearch.Msg._onMouseMove.locTemp,e)}),this._tooltip.updatePosition(t.latlng)}}),i.Map.mergeOptions({rectBox:!1}),i.Map.RectBox=i.Handler.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane},addHooks:function(){i.DomEvent.on(this._container,"mousedown",this._onMouseDown,this),i.DomUtil.addClass(this._container,"leaflet-crosshair"),this._map.dragging.disable()},removeHooks:function(){i.DomEvent.off(this._container,"mousedown",this._onMouseDown,this),i.DomUtil.removeClass(this._container,"leaflet-crosshair")},moved:function(){return this._moved},_resetState:function(){this._moved=!1},_onMouseDown:function(t){this._resetState(),i.DomUtil.disableTextSelection(),i.DomUtil.disableImageDrag(),this._startPoint=this._map.mouseEventToContainerPoint(t),"0.7.7"===i.version?i.DomEvent.on(e,"mousemove",this._onMouseMove,this).on(e,"mouseup",this._onMouseUp,this).on(e,"keydown",this._onKeyDown,this):i.DomEvent.on(e,{contextmenu:i.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=i.DomUtil.create("div","leaflet-zoom-box",this._container),this._map.fire("rectboxstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new i.Bounds(this._point,this._startPoint),a=e.getSize();i.DomUtil.setPosition(this._box,e.min),this._box.style.width=a.x+"px",this._box.style.height=a.y+"px"},_finish:function(){this._moved&&("0.7.7"===i.version?(this._container.removeChild(this._box),this._container.style.cursor=""):(i.DomUtil.remove(this._box),i.DomUtil.removeClass(this._container,"leaflet-crosshair"))),this._map.dragging.enable(),i.DomUtil.enableTextSelection(),i.DomUtil.enableImageDrag(),"0.7.7"===i.version?i.DomEvent.off(e,"mousemove",this._onMouseMove).off(e,"mouseup",this._onMouseUp).off(e,"keydown",this._onKeyDown):i.DomEvent.off(e,{contextmenu:i.DomEvent.stop,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if((1===t.which||1===t.button)&&(this._finish(),this._moved)){setTimeout(i.bind(this._resetState,this),0);var e=new i.LatLngBounds(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fire("rectboxend",{boxBounds:e}),this.endHandler(e)}},endHandler:function(){},_onKeyDown:function(t){27===t.keyCode&&this._finish()}}),i.Map.addInitHook("addHandler","rectBox",i.Map.RectBox),i.Map.ScaleBig=i.Map.RectBox.extend({endHandler:function(t){t&&(this._map.fitBounds(t),this.disable())}}),i.Map.ScaleSmall=i.Map.RectBox.extend({endHandler:function(t){t&&(this.zoomInBounds(t),this.disable())},zoomInBounds:function(t,e){var a=this._map.getZoom();e=e||{},t=t.getBounds?t.getBounds():i.latLngBounds(t);var o=i.point(e.paddingTopLeft||e.padding||[0,0]),n=i.point(e.paddingBottomRight||e.padding||[0,0]),s=this._map.getBoundsZoom(t,!1,o.add(n)),r=n.subtract(o).divideBy(2),l=this._map.project(t.getSouthWest(),s),h=this._map.project(t.getNorthEast(),s),p=this._map.unproject(l.add(h).divideBy(2).add(r),s),c=s-a===0?1:s-a;return s=e&&e.maxZoom?Math.min(e.maxZoom,s):a-c,this._map.setView(p,s,e)}}),i.Util.extend(i.LineUtil,{initTag:function(t,e){if(t&&e)for(var a in e)if(i.Util.isArray(e[a]))for(var o=a,n=0;n<e[o].length;n++){var s=i.DomUtil.create(o);this.initTag(s,e[o][n]),t.appendChild(s)}else if("object"==typeof e[a]&&null!==e[a]){var r=i.Util.replaceAll(a,"1",""),l=i.DomUtil.create(r);this.initTag(l,e[a]),t.appendChild(l)}else if("html"===a){var h=t.innerHTML;t.innerHTML=h+(null!==e[a]?e[a]:"")}else t.setAttribute(a,e[a])},replaceAll:function(t,e,i){return t.replace(new RegExp(e,"gm"),i)}}),i.MapLib.MapMaster={},i.MapLib.MapMaster.vertion="2.4.0",i.MapLib.MapMaster.TileProvider={oTianDiTu:{oNormal:{cName:"天地图",cMap:"http://t{s}.tianditu.cn/DataServer?T=vec_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cva_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]},oSatellite:{cName:"天地卫星图",cMap:"http://t{s}.tianditu.cn/DataServer?T=img_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cia_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]},oTerrain:{cName:"天地地形图",cMap:"http://t{s}.tianditu.cn/DataServer?T=ter_w&X={x}&Y={y}&L={z}",cAnnotion:"http://t{s}.tianditu.cn/DataServer?T=cta_w&X={x}&Y={y}&L={z}",acSubdomains:["0","1","2","3","4","5","6","7"]
}},oMapABC:{oNormal:{cName:"MapABC",cMap:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",acSubdomains:["a","b","c"]}},oGaoDe:{oNormal:{cName:"高德地图",cMap:"http://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oSatellite:{cName:"高德卫星图",cMap:"http://webst0{s}.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oNetRoad:{cName:"高德路网图",cMap:"http://webst0{s}.is.autonavi.com/appmaptile?style=8&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]}},oExSun:{oNormal:{cName:"依迅本地图",cMap:"http://192.168.1.248:9000/map/get/{x}/{y}/{z}",acSubdomains:["1","2","3","4"]},oNormalSvr:{cName:"依迅服务器图",cMap:"http://221.235.53.42:8008/mapimg.aspx?t=mapabc&z={z}&x={x}&y={y}",acSubdomains:["1","2","3","4"]}},oGoogleMap:{oNormal:{cName:"谷歌地图",cMap:"http://mt2.google.cn/vt/lyrs=m@167000000&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oSatellite:{cName:"谷歌卫星图",cMap:"http://mt3.google.cn/vt/lyrs=s&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",acSubdomains:["1","2","3","4"]},oTopographic:{cName:"谷歌地形图",cMap:"http://mt0.google.cn/vt/lyrs=t&hl=zh-CN&gl=cn&x={x}&y={y}&z={z}",nMaxLevel:16,acSubdomains:["1","2","3","4"]}},oArcMap:{oFoursquare:{cMap:"http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineStreetPurplishBlue/MapServer/tile/{z}/{y}/{x}",cName:"灰度图",acSubdomains:["1","2","3","4"]}},oTDMap:{oNormal:{cName:"立体图",cMap:"https://a.tiles.mapbox.com/v3/foursquare.map-0y1jh28j/{z}/{x}/{y}.png",acSubdomains:["1","2","3","4"]}}},i.MapLib.MapMaster.TileProvider[0]=i.MapLib.MapMaster.TileProvider.oTianDiTu.oNormal,i.MapLib.MapMaster.TileProvider[1]=i.MapLib.MapMaster.TileProvider.oTianDiTu.oSatellite,i.MapLib.MapMaster.TileProvider[2]=i.MapLib.MapMaster.TileProvider.oTianDiTu.oTerrain,i.MapLib.MapMaster.TileProvider[3]=i.MapLib.MapMaster.TileProvider.oMapABC.oNormal,i.MapLib.MapMaster.TileProvider[4]=i.MapLib.MapMaster.TileProvider.oGaoDe.oNormal,i.MapLib.MapMaster.TileProvider[5]=i.MapLib.MapMaster.TileProvider.oGaoDe.oSatellite,i.MapLib.MapMaster.TileProvider[6]=i.MapLib.MapMaster.TileProvider.oGaoDe.oNetRoad,i.MapLib.MapMaster.TileProvider[7]=i.MapLib.MapMaster.TileProvider.oExSun.oNormal,i.MapLib.MapMaster.TileProvider[8]=i.MapLib.MapMaster.TileProvider.oExSun.oNormalSvr,i.MapLib.MapMaster.TileProvider[9]=i.MapLib.MapMaster.TileProvider.oGoogleMap.oNormal,i.MapLib.MapMaster.TileProvider[10]=i.MapLib.MapMaster.TileProvider.oGoogleMap.oSatellite,i.MapLib.MapMaster.TileProvider[11]=i.MapLib.MapMaster.TileProvider.oGoogleMap.oTopographic,i.MapLib.MapMaster.TileProvider[12]=i.MapLib.MapMaster.TileProvider.oArcMap.oFoursquare,i.MapLib.MapMaster.TileProvider[13]=i.MapLib.MapMaster.TileProvider.oTDMap.oNormal,i.MapLib.MapMaster.Err={1:"没有设置图层！",2:"Map parent container not found."},i.MapLib.MapMaster.EventName={loadFinish:"Map:loadFinish"},i.MapLib.MapMaster.Map=i.Evented.extend({options:{cDidId:"divMap",cDivContainerId:"divContainer",nDefaultTile:4,oMapOption:{zoomControl:!1,layers:[],center:new i.LatLng(30.55072,114.29471),zoom:10},oTileOption:{maxZoom:18,minZoom:3,attribution:'Map &copy;GB-20263—2018 <a target="_blank" href="#">电子地图</a> '},anLoadTile:[4,5,6,9,10,11,12],oProvider:i.MapLib.MapMaster.TileProvider,nMapWidth:600,nMapHeight:500},cDiv:"div",initialize:function(t,e){return i.setOptions(this,e),this._oParent=t,this._oBaseLayer={},this._oDefaultTile=void 0,this._initTile(),this._getDefaultLayer(),this},getDefaultTile:function(){var t=this.options.oProvider[this.options.nDefaultTile].cName;return this._oBaseLayer[t]},loadMapMaster:function(){return this._loadMap(),this},getMap:function(){return this._oMap},getBaseLayers:function(){if(!this._oBaseLayer)throw new Error(i.MapLib.MapMaster.Err[1]);return this._oBaseLayer},_getDefaultLayer:function(){var t=this.options.oProvider[this.options.nDefaultTile].cName;return this._oDefaultTile=this._oBaseLayer[t],this._oDefaultTile},_loadMap:function(){var t=i.DomUtil.get(this.options.cDidId),e=this.options.nMapWidth,a=this.options.nMapHeight;if(!t){var o=i.DomUtil.get(this.options.cDivContainerId);if(!o)throw new Error(i.MapLib.MapMaster.Err[2]);t=i.DomUtil.create(this.cDiv,"",o)}t.style.width=e+"px",t.style.height=a+"px",t.id=this.options.cDidId,i.Util.extend(this.options.oMapOption,{layers:[this._oDefaultTile]});var n=this._oMap=new i.Map(this.options.cDidId,this.options.oMapOption);return this._oParent&&(this._oParent.setMap&&this._oParent.setMap(n),this._oParent.fire("Map:loadFinish",{oMap:n}),this.fire("Map:loadFinish",{oMap:n})),n},_initTile:function(){var t=i.extend({},this.options.oTileOption),e=this.options.oProvider,a=this.options.anLoadTile;if(a&&!(a.length<=0)&&e){for(var o={},n=0;n<a.length;n++){var s=e[a[n]];t.maxZoom=s.nMaxLevel||t.maxZoom,t.minZoom=s.nMinLevel||t.minZoom,t.subdomains=s.acSubdomains;var r=i.tileLayer(s.cMap,t);o[s.cName]=r}this._oBaseLayer=o,this._oParent&&this._oParent.fire("Map:loadTileFinish",{oBaseLayer:o}),this.fire("Map:loadTileFinish",{oBaseLayer:o})}},reflesh:function(t,e){if(this._oMap){var i=this._oMap.getContainer();t&&(i.style.width=t+"px"),e&&(i.style.height=e+"px"),this._oMap._onResize()}}}),i.MapLib.MapMaster.Map.include({cTopLeftConfig:{div:{"class":"ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left"}},cTopRightConfig:{div:{"class":"ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left"}},initTopLeft:function(t){var e=i.DomUtil.get(this.options.cDidId);e&&(t?i.Util.initTag(e,t):i.Util.initTag(e,this.cTopLeftConfig))},initTopRight:function(){}}),i.MapLib.MapMaster.MapOpr=i.Evented.extend({options:{nFlyZoom:10,nFlyDuration:1,nFlyMaxZoom:15,cFlayMapVertion:"1.0"},initialize:function(t,e,a){e=i.setOptions(this,e),this._oParent=t,a&&a instanceof i.Map?this._oMap=a:t&&(t._oMap&&t._oMap instanceof i.Map?this._oMap=t._oMap:t instanceof i.Map&&(this._oMap=t)),this._initOn()},flyTo:function(t,e){if(this._oMap){var a=null;if(t.hasOwnProperty("oGpsInfo")){var o=t.oGpsInfo;a=i.latLng(o.Lat,o.Lon)}if(t instanceof i.LatLng&&(a=t),t.hasOwnProperty("lat")&&t.hasOwnProperty("lng")&&(a=i.latLng(t.lat,t.lng)),t.hasOwnProperty("Lat")&&t.hasOwnProperty("Lng")&&(a=i.latLng(t.Lat,t.Lng)),!(i.version<this.options.cFlayMapVertion))return this._oMap.getBounds().contains(a)&&this._oMap.getZoom()>=this.options.nFlyMaxZoom?void this._oMap.panTo(a):(e||(e={}),this._oMap.flyTo(a,e.zoom||this.options.nFlyZoom,{duration:e.duration||this.options.nFlyDuration}),this)}},reflesh:function(){return this._oMap?(this._oMap._onResize(),this):void 0},findLayer:function(t,e){if(!t||t.getLayers().length<=0)return null;var i=t.getLayers();for(var a in i)if(i[a].cId===e)return i[a];return null},findLayerInMap:function(t){if(!this._oMap)return null;var e=this._oMap._layers;if(!e)return null;var i=[];for(var a in e)e[a].cId===t&&i.push(e[a]);return i},posInSrceen:function(t){if(!this._oMap)return!1;var e=this._oMap.getBounds();return e.contains(t)},_drawTip:function(t,e){var a={cId:"1",cName:"测试tip",bNoHide:!0};i.Util.extend(a,e);var o=new i.DivIcon({html:"<div> </div>",className:""}),n=i.marker(t,{icon:o,bIsNotEdit:!0});return n.cId="TM_"+a.cId,n.bindLabel(a.cName,{noHide:a.bNoHide,direction:"auto"}),n},setMap:function(t){return t instanceof i.Map&&(this._oMap=t),this},delPosNotInScreen:function(t,e){if(t&&!(t.length<=0)){e||(e=this.oMap.getBounds());for(var a=t.length-1;a>=0;a--){var o=i.latLng(t[a].oLatLng.lat,t[a].oLatLng.lng);e.contains(o)||t.splice(a,1)}return this}},_loadPage:function(){},_initOn:function(){}}),i.MapLib.MapControl={},i.MapLib.MapControl.Layout=i.Evented.extend({options:{pContainer:"ex-layout-content",mapDivId:"MapView"},initialize:function(t,e){i.setOptions(this,e),this._oParent=t,this.pContainer=e.pContainer,"object"!=typeof e.pContainer&&(this.pContainer=$(this.options.pContainer)),this.initUI(),this.initOn()},initUI:function(){var t=i.create("div","ex-layout-map-content",this.pContainer);i.create("div","ex-layout-type-wbox ex-map-bottom ex-map-right",t),i.create("div","ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left  ec-padding-0",t),i.create("div","ex-layout-maptool ex-theme-maptool ex-map-top ex-map-right",t),i.create("div","ex-layout-monitor-wbox",t),this.container=t,t.id=this.options.mapDivId},initOn:function(){this._oParent&&this._oParent.on("MapControl:Layout.addToolItem",this.addToolItem,this)},addToolItem:function(t){},_addToolItem:function(t){},getWidth:function(){return this.container.width()},dueWidth:function(t){this.container.width(this.container.width()-t)},setWidth:function(t){this.container.width(t)}}),i.MapLib.MapControl.ESMapEdit=i.Evented.extend({options:{cParentDiv:"MapView",acParentDivClass:["ex-layout-maptool","ex-theme-maptool","ex-map-top","ex-map-left","ex-maptool-edit"],cBtnContain:".ex-map-tool-edit",className:"",title:"图层编辑",penStyle:{stroke:!0,color:"#0FFF05",dashArray:null,lineCap:null,lineJoin:null,weight:3,opacity:1,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1}},hide:function(t){t.style.display="none"},show:function(t){t.style.display="block"},initialize:function(t,a){i.extend(this.options,a),this.oPenStyle=this.options.penStyle,this._oMapBase=t,this._oMap=t._oMap,this._oDrawLayer=i.featureGroup(),this._oDrawLayer.addTo(this._oMap),this._pContainer=e.getElementsByClassName(this.options.acParentDivClass),this.cFlag="add",this.setParentEvent(),this.initPen(),this.initUI(),this.initCallBack(),this.initOn()},initOn:function(){this._oMapBase._oParent.on("ESMapEdit:showEditDraw",this.showEditAdd,this),this._oMapBase._oParent.on("ESMapEdit:clearLayers",this.clearLayers,this),this._oMapBase._oParent.on("ESMapEdit:deleteFence",this.deleteFence,this),this._oMapBase._oParent.on("ESMapEdit:editDraw",this.editDraw,this)},editDraw:function(t){this.cFlag="edit";var e=t.MapX.split(","),a=t.MapY.split(",");if(e&&a&&!(e.length<=0)){for(var o=[],n=0;n<e.length;n++){var s=i.latLng(parseFloat(a[n]),parseFloat(e[n]));o.push(s)}var r=i.polygon(o,this.oPenStyle).addTo(this._oDrawLayer);r.cId=t.Id,r.oFenceInfo=t,r.bindTooltip(t.Name).openTooltip(),this.fitBound(),this.$_btnPlus.hide(),this.$_btnEdit.show(),this.$_btnDel.show(),this.$_btnCal.hide(),this.$_btnSave.hide(),this.dealEditUI()}},fitBound:function(){if(this._oDrawLayer){var t=this._oDrawLayer.getBounds();this._oMap.fitBounds(t)}},drawTip:function(t){var e={bIsNotEdit:!0,cName:"测试tip显示名称",oLatLng:{lat:30.333,lng:113.333},bNoHide:!0};i.extend(e,t);var a=new i.DivIcon({html:"<div> </div>",className:""}),o=i.marker(e.oLatLng,{icon:a,bIsNotEdit:e.bIsNotEdit});return o.cId=e.cId,o.bindLabel(e.cName,{noHide:e.bNoHide,direction:"auto"}),o},deleteFence:function(){this._oDrawLayer.clearLayers(),this.$_btnCal.hide(),this.$_btnEdit.hide(),this.dealEditUI()},clearLayers:function(){this._oDrawLayer.clearLayers(),this.$_btnCal.hide(),this.dealEditUI()},showEditAdd:function(){this.cFlag="add",this.show(),this.clearLayers(),$(this.oOption.cBtnContain).find(".ec-icon-plus").parent().click()},dealEditUI:function(){for(var t=this._oContainer.getElementsByTagName("a"),e=!1,i=0;i<t.length;i++)"none"!==t[i].style.display&&(e=!0);e?this.show(this._oContainer):this.hide(this._oContainer)},initPen:function(){this.oDrawPen={enabled:{shapeOptions:this.oPenStyle},handler:new i.Draw.Polygon(this._oMap,{shapeOptions:this.oPenStyle}),title:i.drawLocal.draw.toolbar.buttons.polygon},this.oEditPen={enabled:this.oPenStyle,handler:new i.EditToolbar.Edit(this._oMap,{featureGroup:this._oDrawLayer,selectedPathOptions:{dashArray:"10, 10",fill:!0,fillColor:"#fe57a1",fillOpacity:.1,maintainColor:!1},poly:{allowIntersection:!1}}),title:i.drawLocal.edit.toolbar.buttons.edit}},setParentEvent:function(){},initUI:function(){var t=i.create("div","ex-maptool-box",this._pContainer),e=i.create("ul","ec-avg-sm-1 ex-map-tool-edit",t);this._createTool(e),this.initEven();this.oOption.cBtnContain;this.hide(this.btnPlus),this.hide(this.btnEdit),this.hide(this.btnCal),this.hide(this.btnSave),this.hide(this.btnDel),this.dealEditUI()},_createTool:function(t){var e=i.create("li","",t);this.btnPlus=i.create("a","ec-icon-plus",e),this.btnPlus.text("&nbsp;&nbsp;绘制"),e=i.create("li","",t),this.btnEdit=i.create("a","ec-icon-pencil",e),this.btnEdit.text("&nbsp;编&nbsp;&nbsp;辑"),e=i.create("li","",t),this.btnCal=i.create("a","ec-icon-power-off",e),this.btnCal.text("&nbsp;删&nbsp;&nbsp;除"),e=i.create("li","",t),this.btnSave=i.create("a","ec-icon-save",e),this.btnSave.text("&nbsp;确&nbsp;&nbsp;定"),e=i.create("li","",t),this.btnDel=i.create("a","ex-map-tool-cancel",e),this.btnDel.text("&nbsp;取&nbsp;&nbsp;消")},initEven:function(){var t=this;i.DomEvent.on(this.btnPlus,"click",function(){t.oDrawPen.handler.enable(),t.btnPlus.hide(),t.btnSave.hide(),t.btnEdit.hide(),t.hide(this.btnPlus),t.hide(this.btnEdit),t.hide(this.btnSave),t.show(this.btnCal),t.dealEditUI()},this),i.DomEvent.on(this.btnSave,"click",function(){t.oEditPen.handler.save(),t.oEditPen.handler.disable(),t.hide(this.btnPlus),t.hide(this.btnEdit),t.hide(this.btnCal),t.hide(this.btnSave),t.dealEditUI()},this),i.DomEvent.on(this.btnEdit,"click",function(){this.hide(this.btnEdit),this.show(this.btnSave),this.show(this.btnCal),this.dealEditUI(),this.oEditPen.handler.enable()}),i.DomEvent.on(this.btnCal,"click",function(){"add"===t.cFlag&&(this.hide(this.btnPlus),this.hide(this.btnSave),this.hide(this.btnCal),this.hide(this.btnEdit)),"edit"===t.cFlag&&(this.hide(this.btnPlus),this.hide(this.btnSave),this.hide(this.btnCal),this.show(this.btnEdit)),t.oDrawPen.handler.disable(),t.oEditPen.handler.revertLayers(),t.oEditPen.handler.disable(),t.dealEditUI()},this),i.DomEvent.on(this.btnDel,"click",function(){this.hide(this.btnDel),"add"===t.cFlag&&(this.hide(this.btnPlus),this.hide(this.btnSave),this.hide(this.btnCal),this.hide(this.btnEdit)),"edit"===t.cFlag&&(this.hide(this.btnPlus),this.hide(this.btnSave),this.hide(this.btnCal),this.show(this.btnEdit)),"del"===t.cFlag,t.oDrawPen.handler.disable(),t.oEditPen.handler.revertLayers(),t.oEditPen.handler.disable(),t.dealEditUI()})},initCallBack:function(){var t=this;this._oMap.on("draw:created",function(e){var i=e.layer;t._oDrawLayer.addLayer(i);var a=t._getGisObj(i);t._oMapBase._oParent.fire("FenceView:UI.addFence",a)}),this._oMap.on("draw:edited",function(e){var i=e.layers;i.eachLayer(function(e){var i=t._getGisObj(e);t._oDrawLayer.addLayer(e),i.cId=e.cId,i.oFenceInfo=e.oFenceInfo,t._oMapBase._oParent.fire("FenceView:UI.updateFence",i)})})},getDrawModeHandlers:function(){return[{enabled:this.options.polyline,handler:new i.Draw.Polyline(this._oMap,this.options.polyline),title:i.drawLocal.draw.toolbar.buttons.polyline},{enabled:{shapeOptions:this.oPenStyle},handler:new i.Draw.Polygon(this._oMap,{shapeOptions:this.oPenStyle}),title:i.drawLocal.draw.toolbar.buttons.polygon},{enabled:this.options.rectangle,handler:new i.Draw.Rectangle(this._oMap,this.options.rectangle),title:i.drawLocal.draw.toolbar.buttons.rectangle},{enabled:this.options.circle,handler:new i.Draw.Circle(this._oMap,this.options.circle),title:i.drawLocal.draw.toolbar.buttons.circle},{enabled:this.options.marker,handler:new i.Draw.Marker(this._oMap,this.options.marker),title:i.drawLocal.draw.toolbar.buttons.marker}]},getEditModeHandlers:function(){return[{enabled:this.oPenStyle,handler:new i.EditToolbar.Edit(this._oMap,{featureGroup:this._oDrawLayer,selectedPathOptions:this.options.edit.selectedPathOptions,poly:this.options.poly}),title:i.drawLocal.edit.toolbar.buttons.edit},{enabled:{},handler:new i.EditToolbar.Delete(this._oMap,{featureGroup:this._oDrawLayer}),title:i.drawLocal.edit.toolbar.buttons.remove}]},_getGisObj:function(t){var e={},a=t.options;if(t instanceof i.Circle){var o=t.getLatLng(),n=i.latLng([o.lat+t._getLatRadius(),o.lng]);e={aoLatLng:[o,n],dRadius:t.getRadius(),oOption:a,nType:this.getObjType(t)}}else e={aoLatLng:t.getLatLngs(),oOption:a,nType:this.getObjType(t)};return e},getObjType:function(t){return t instanceof i.Rectangle?3:t instanceof i.Polygon?1:t instanceof i.Polyline?4:t instanceof i.Circle?2:1}}),i.MapLib.MapControl.ESMapFull=i.Evented.extend({options:{cSelfDiv:"ex-map-full",acParentDivClass:["ex-layout-maptool","ex-theme-maptool","ex-map-top","ex-map-right"],cClassName:"",cTitle:"地图全屏"},initialize:function(t,a){i.extend(this.options,a),this._oMapBase=t,this._oMap=t._oMap,this._layers={},this._lastZIndex=0,this.oPContainer=e.getElementsByClassName(this.options.acParentDivClass),this.setParentEvent(),this.initUI()},setParentEvent:function(){},initUI:function(){this.container=i.create("div","ex-maptool-box ex-map-full",this.oPContainer),this.container.innerHTML="&nbsp;&nbsp;全屏",i.create("i","ec-icon-expand",this.container),this.initToolEvent()},initToolEvent:function(){i.DomEvent.on(this.container,"click",function(){this.isFullscreen?($("body").removeClass("map_full"),this.container.innerHTML='<i class="ec-icon-expand"></i>&nbsp;&nbsp;全屏'):($("body").addClass("map_full"),this.container.innerHTML='<i class="ec-icon-compress"></i>&nbsp;&nbsp;恢复')},this)}}),i.MapLib.MapControl.ESMapTile=i.Evented.extend({oOption:{cParentDiv:"MapView",acParentDivClass:["ex-layout-maptool","ex-theme-maptool","ex-map-top","ex-map-left"],cClassName:"",title:"图层切换"},oUIConfig:{div:{"class":"ex-maptool-box ex-control-dropmenu  map-tile",i:{"class":"ec-icon-clone"},html:"&nbsp;&nbsp;",span:{html:"高德地图"},i11:{"class":"ec-icon-angle-down"},ul:{"class":"ec-avg-sm-1 ec-dropdown-content",li:[{a:{href:"javascript:void(0);",html:"高德地图"}},{a:{href:"javascript:void(0);",html:"高德卫星图"}},{a:{href:"javascript:void(0);",html:"谷歌地图"}},{a:{href:"javascript:void(0);",html:"谷歌卫星图"}},{a:{href:"javascript:void(0);",html:"谷歌地形图"}},{a:{href:"javascript:void(0);",html:"灰度图"}}]}}},initialize:function(t,a){i.extend(this.oOption,a),this._oMapBase=t,this._oMap=t._oMap,this._layers={},this._lastZIndex=0,this.oPContainer=e.getElementsByClassName(this.options.acParentDivClass);var o=this._oMapBase.getBaseLayers();for(var n in o)this._addLayer(o[n],n);this.setParentEvent(),this.initUI()},_addLayer:function(t,e,a){var o=i.stamp(t);this._layers[o]={layer:t,name:e,overlay:a},this.oOption.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex))},setParentEvent:function(){i.DomEvent.addListener(this.$_oPContainer.get(0),"click",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.$_oPContainer.get(0),"dblclick",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.$_oPContainer.get(0),"mousemove",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.$_oPContainer.get(0),"mousewheel",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.$_oPContainer.get(0),"touchmove",i.DomEvent.stopPropagation)},initUI:function(){this.container=i.create("div","ex-maptool-box ex-control-dropmenu",this.pContainer),i.create("i","ec-icon-clone",this.container),this.span=i.create("span","",this.container),this.span.innerHTML="高德地图",i.create("i","ec-icon-angle-down",this.container);i.create("ul","ec-avg-sm-1 ec-dropdown-content",this.container);this.initToolEvent()},initToolEvent:function(){var t=this,e=i.create("li","",ul),a=i.create("a","",e);a.innerHTML='<i class="ex-icon-maptool ex-maptool-china">&nbsp;高德地图</i>',i.DomEvent.on(a,"click",function(e){var i=e.innerText.trim();this.container.getElementsByTagName("span").html(i),t.selectLayer(i)},this),i.DomEvent(this.container,"mouseover,mouseout",function(e){t._oMap.doubleClickZoom.disable(),t._oMap.doubleClickZoom.enable()},this)},selectLayer:function(t){"灰度图"===t&&this._oMap.getZoom()>16&&this._oMap.setZoom(16);for(var e in this._layers){var i=this._layers[e];i.name!==t||this._oMap.hasLayer(i.layer)?this._oMap.hasLayer(i.layer)&&i.name!==t&&this._oMap.removeLayer(i.layer):this._oMap.addLayer(i.layer)}}}),i.MapLib.MapControl.ESMapToolBox=i.Evented.extend({options:{cParentDiv:"MapView",acParentDivClass:["ex-layout-maptool","ex-theme-maptool","ex-map-top","ex-map-left"],cClassName:"",title:"图层切换"},initialize:function(t,a){a.oUIConfig&&(i.extend(this.oUIConfig,a.oUIConfig),delete a.oUIConfig),i.extend(this.oOption,a),this._oMapBase=t,this._oMap=t._oMap,this.oPContainer=e.getElementsByClassName(this.options.acParentDivClass),this.initUI(),this.setParentEvent(),this.initMapTool(),this.oActHandler=null},initMapTool:function(){this.oScaleBig=new i.Map.ScaleBig(this._oMap),this.oScaleSmall=new i.Map.ScaleSmall(this._oMap),this.oDistantHandler=i.MapLib.Measure.distMgr(this._oMap),this.oAreaHandler=i.MapLib.Measure.areaMgr(this._oMap,{}),this.oMapToolLocal=new i.MapLib.LocaltionSearch.Search(this._oMap)},setParentEvent:function(){i.DomEvent.addListener(this.container,"click",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.container,"dblclick",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.container,"mousemove",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.container,"mousewheel",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.container,"touchmove",i.DomEvent.stopPropagation)},initUI:function(){this.container=i.create("div","ex-maptool-box ex-control-dropmenu",this.pContainer),i.create("i","ec-icon-briefcase",this.container),this.span=i.create("span","",this.container),this.span.innerHTML="工具",i.create("i","ec-icon-briefcase",this.container);var t=i.create("ul","ec-avg-sm-1 ec-dropdown-content",this.container);this.initToolEvent(t)},initToolEvent:function(t){var e=i.create("li","",t),a=i.create("a","",e);a.innerHTML='<i class="ex-icon-maptool ex-maptool-china">&nbsp;全国</i>',i.DomEvent.on(a,"click",function(t){var e=t.innerText.trim();this.container.getElementsByTagName("span").html(e),self.oActHandler&&self.oActHandler.disable(),self._oMap.setView(new i.LatLng(35,103.5),4)},this),e=i.create("li","",t),a=i.create("a","",e),a.innerHTML='<i class="ex-icon-maptool ex-maptool-range">&nbsp;测距</i>',i.DomEvent.on(a,"click",function(t){var e=t.innerText.trim();this.container.getElementsByTagName("span").html(e),this.oActHandler&&this.oActHandler.disable(),this.oActHandler=self.oDistantHandler,this.oActHandler.enable()},this),e=i.create("li","",t),a=i.create("a","",e),a.innerHTML='<i class="ex-icon-maptool ex-maptool-area">&nbsp;测面</i>',i.DomEvent.on(a,"click",function(t){var e=t.innerText.trim();this.container.getElementsByTagName("span").html(e),this.oActHandler&&this.oActHandler.disable(),this.oActHandler=self.oAreaHandler,this.oActHandler.enable()},this),e=i.create("li","",t),a=i.create("a","",e),a.innerHTML='<i class="ex-icon-maptool ex-maptool-scale-big">&nbsp;拉框放大</i>',i.DomEvent.on(a,"click",function(t){var e=t.innerText.trim();this.container.getElementsByTagName("span").html(e),this.oActHandler&&this.oActHandler.disable(),self.oActHandler=self.oScaleBig,self.oActHandler.enable()},this),e=i.create("li","",t),a=i.create("a","",e),a.innerHTML='<i class="ex-icon-maptool ex-maptool-scale-small">&nbsp;拉框缩小</i>',i.DomEvent.on(a,"click",function(t){var e=t.innerText.trim();this.container.getElementsByTagName("span").html(e),this.oActHandler&&this.oActHandler.disable(),self.oActHandler=self.oScaleSmall,self.oActHandler.enable()},this),e=i.create("li","",t),a=i.create("a","",e),a.innerHTML='<i class="ex-icon-maptool ex-maptool-location">&nbsp;坐标查询</i>',i.DomEvent.on(a,"click",function(t){var e=t.innerText.trim();this.container.getElementsByTagName("span").html(e),this.oActHandler&&this.oActHandler.disable(),self.oActHandler=self.oMapToolLocal,self.oActHandler.enable()},this)}}),i.MapLib.MapControl.ESMapSearch=i.Evented.extend({options:{cParentDiv:"MapView",acParentDivClass:["ex-layout-maptool","ex-theme-maptool","ex-map-top","ex-map-left"],className:"",title:"图层切换",cUrl:"/MapView/PoiSearch",oParam:{key:"",keywords:"",types:"050301",location:"113.22,30.333",city:"",citylimit:"",datatype:"poi",output:"JSON"}},initialize:function(t,e){i.extend(this.options,e),this._oMapBase=t,this._oMap=t._oMap,this.oLayer=i.featureGroup(),this.oInputData=null,this.oLayer.addTo(this._oMap);var a=this._oMap.getContainer();this.oPContainer=a.getElementsByClassName(this.options.acParentDivClass),this.initUI(),this.setParentEvent(),this.initToolEvent()},setParentEvent:function(){i.DomEvent.addListener(this.container,"dblclick",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.container,"mousemove",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.container,"mousewheel",i.DomEvent.stopPropagation),i.DomEvent.addListener(this.container,"touchmove",i.DomEvent.stopPropagation)},initUI:function(){this.container=i.create("div","ex-maptool-box",this.oPContainer);var t=i.create("div","ec-input-group ex-maptool-search-box",this.container);this.input=i.create("input","ec-form-field",t);var e=i.create("span","ec-input-group-btn",t);this.ul=i.create("ul","ex-maptool-box-search-result",t),this.search=i.create("button","ec-btn ec-btn-primary ec-btn-sm search",e),this.clear=i.create("button","ec-btn ec-btn-default ec-btn-sm clear",e),this.search.innerHTML='<span class="ec-icon-search"></span>',this.clear.innerHTML='span class="ec-icon-close">',i.MapLib.hide(this.search)},initToolEvent:function(){var a=this,o=!1;i.DomEvent.on(e,"keyup",function(e){var n=e||t.event,s=n.keyCode;38!=s&&40!=s&&(a.oInputData&&a.oInputData.name===this.input.innerText||(o&&clearTimeout(o),o=setTimeout(function(){var t=a.$_oInput.val(),e=a._oMap.getCenter(),o={};i.extend(o,a.oOption.oParam,{keywords:t,location:e.lng+","+e.lat}),i.getData(o,a.oOption.cUrl,a.searchPoiHandler,a)},250)))},this),i.DomEvent.on(e,"keydown",function(e){if("none"!==this.search.style.display){var i=e||t.event,a=i.keyCode;38===a?this.movePrev():40===a&&this.moveNext(),13===a&&this.localPos()}},this),i.DomEvent.on(this.clear,"click",function(t){this.oLayer.clearLayers(),this.input.innerText=""},this),i.DomEvent.on(this.search,"click",function(t){var e=this.input.innerText,a=this._oMap.getCenter(),o={};i.extend(o,this.options.oParam,{keywords:e,location:a.lng+","+a.lat}),i.getData(o,this.options.cUrl,this.searchPoiHandler,this)},this)},localPos:function(){this.oLayer.clearLayers();var t=this.ul.getElementsByClassName("ec-active"),e=t.data("oData"),a=i.marker([e.lat,e.lng]);a.oData=e,a.addTo(this.oLayer),this._oMap.flyTo([e.lat,e.lng],16),this.input.innerText=e.name,this.oInputData=e,this.ul.innerHTML="",i.MapLib.hide(this.search)},getSelectIndex:function(t){for(var e=0;t>e;e++)if(i.DomUtil.hasClass(t[e],"ec-active"))return e;return-1},movePrev:function(){var t=this.ul.getElementsByTagName("li");if(i.DomUtil.hasClass(t[0],"ec-active"))return this.input.focus(),!1;var e=this.getSelectIndex(t);i.DomUtil.removeClass(t[e],"ec-active"),i.DomUtil.addClass(t[e-1],"ec-active");var a=t[e-1].oData;this.input.innerText=a.name},moveNext:function(){var t=this.ul.getElementsByTagName("li"),e=this.getSelectIndex(t,"ec-active");if(-1===e&&(i.DomUtil.addClass(t[0],"ec-active"),this.input(t[0].oData.name)),e===t.length-1)return!1;i.DomUtil.removeClass(t[e],"ec-active"),i.DomUtil.addClass(t[e+1],"ec-active");var a=t[e+1].oData;this.input.innerText=a.name},searchPoiHandler:function(t){if(this.ul.innerHTML="",i.MapLib.hide(this.search),t&&0!==t.status&&!(t.count<=0)){for(var e=0;e<t.tips.length;e++)if(0!==t.tips[e].lng){t.tips[e].cDist=t.tips[e].district||"";var a=i.create("li","location",this.ul);a.innerHTML=i.Util.template(" <b>{name}</b><span>{cDist}</span> ",t.tips[e]),a.oData=t.tips[e],i.DomEvent.on(a,"click",this,function(t){t.data.localPos()},this),i.DomEvent.on(a,"mouseover",this,function(t){t.addClass("ec-active")},this),i.DomEvent.on(a,"mouseout",this,function(t){t.removeClass("ec-active")},this)}i.MapLib.show(this.search)}}})}(window,document,L);