

/*
Track-1.0.0 code for exsun

Copyright©2015-2018 武汉依迅北斗空间技术有限公司 All Rights Reserved.

http://www.exsun.cn
*/

!function(t,e,a,r){var n={dLat:"30.576746",dLng:"114.306221"};r(function(){var e=r(t).height(),i=r(t).width(),o=new ES.TrackView.Page("MapView",{});new ES.TrackView.Layout(o,{nWidth:i,nHeight:e});var s=new a.MapLib.MapMaster.Map(o,{cDidId:"MapView",oMapOption:{zoomControl:!1,layers:[],center:new a.LatLng(n.dLat,n.dLng),zoom:13},nMapWidth:i,nMapHeight:e});s.loadMapMaster(),new a.MapLib.MapControl.ESMapToolBox(s,{}),new a.MapLib.MapControl.ESMapTile(s,{});new ES.TrackView.Bar(o,{});new ES.TrackView.TrackChart(o,{});var l=new ES.TrackView.Control(o,{});new ES.TrackView.TrackData(o,{}),new ES.TrackView.RealTrack.TrackPos(o,{}),new ES.TrackView.RealTrack.TrackLine(o,{}),new ES.TrackView.RealTrack.TrackMarker(o,{}),new ES.TrackView.PointLayer.BeginMarker(o,{cPosName:"轨迹开始点"}),new ES.TrackView.PointLayer.EndMarker(o,{cPosName:"轨迹结束点"}),new ES.TrackView.PointLayer.SubMarkerMgr(o,{cPosName:"轨迹点"}),new ES.TrackView.PointLayer.ParkMarkerMgr(o,{cPosName:"停留点"}),new ES.TrackView.PointLayer.AlarmMarkerMgr(o,{cPosName:"告警点"}),new ES.TrackView.PanelBox.ParkPanel(o,{}),new ES.TrackView.PanelBox.AlarmPanel(o,{}).alarmFilter(),new ES.TrackView.PanelBox.SpeedDoorWeightPanel(o,{}),new ES.VehTrackInfo.SpeedChart(o,{}),new ES.TrackView.AlarmTrack(o,{}),new ES.TrackView.HistoryTrack(o,{}),l.searchTrack(),new ES.TrackView.SiteLayer(o,{}),new ES.TrackView.UnloadLayer(o,{}),new ES.TrackView.WorkSiteLayer(o,{}),new ES.TrackView.WorkUnloadLayer(o,{}),new ES.TrackView.SusSiteLayer(o,{}).drawLayers(),new ES.TrackView.SusUnloadLayer(o,{}).drawLayers(),r(t).resize(function(){r("#MapView , .ex-layout-content").css({height:r(t).height(),width:r(t).width()}),r(".ex-layout-track-chart").stop().animate({"max-height":r(t).height()-275+"px"},500)})}),ES.TrackHelper={getAlarmTypeName:function(t){var e=this.getAlarmType();if(e)return e[t]},getAlarmType:function(){return{1:"紧急报警",2:"超速报警",3:"疲劳驾驶",4:"预警",5:"GNSS模块发生故障",6:"定位天线被剪断",7:"GNSS天线短路",8:"终端主电源欠压",9:"电源掉电",10:"终端LCD或显示器故障",11:"TTS模块故障",12:"摄像头故障",13:"当天累计驾驶超时",14:"超时停车",15:"进出区域",16:"进出路线",17:"路段行驶时间不足_过长",18:"路线偏离报警",19:"车辆VSS故障",20:"车辆油量异常",21:"车辆被盗",22:"车辆非法点火",23:"车辆非法位移",24:"碰撞侧翻报警",25:"SD卡异常",26:"进区域报警",27:"出区域报警",28:"超线报警",200:"重量传感器可疑故障",201:"顶棚可疑故障",107:"不按线路行驶",106:"平台超速报警",100:"未密闭",101:"超载",206:"无运输许可证",103:"正常出土",105:"可疑出土",104:"可疑消纳",102:"正常消纳",210:"非工作时间运输",211:"工地可疑出土",212:"工地正常出土",213:"消纳场可疑消纳",214:"消纳场正常消纳"}},getObjType:function(t){return t instanceof a.Rectangle?501001:t instanceof a.Polygon?501003:t instanceof a.Polyline?501004:t instanceof a.Circle?501002:1},getPosW:function(t){var e={vPos:10,aPos:20};return e.hasOwnProperty(t)?e[t]:null},getDire:function(t){var e=0;return e="object"==typeof t?t.Direction:t,e>=0&&e<=15||e>345&&e<=360?"正北":e>15&&e<=75?"东北":e>75&&e<=105?"正东":e>105&&e<=165?"东南":e>165&&e<=195?"正南":e>195&&e<=255?"西南":e>255&&e<=285?"正西":e>285&&e<=345?"西北":void 0},getDateMsg:function(t){var e=(new Date).getTime(),a=e-t;if(a>864e5){var i=(e-t)/864e5;return"["+parseInt(i)+"天前]"}if(a>36e5&&a<=864e5){var r=a/36e5;return"["+parseInt(r)+"小时前]"}var r=parseInt(a/6e4);return r<=0?"":"["+parseInt(r)+"分钟前]"},getVehStatusClass:function(t){var e={};return"行驶"==t.VehicleStatus||"停车"==t.VehicleStatus||"熄火"==t.VehicleStatus?(e.cStatus="l-bd-on l-mobile-on",e.cLstClass=""):"通讯中断"==t.VehicleStatus?(e.cStatus="l-bd-off l-mobile-off",e.cLstClass="gray"):"定位失败"==t.VehicleStatus&&(e.cStatus="l-bd-off l-mobile-on",e.cLstClass="gray"),e},convertVehStatus:function(t){if(t.nGreenOn=0,t.nRedOn=0,t.nYelloOn=0,t.cLight="白灯",t.cClsLight="gray",t.attach){var e=t.attach;"True"===e.ZtLeightGreenOn&&(t.nGreenOn=1,t.cLight="绿灯",t.cClsLight="green"),"True"===e.ZtLeightRedOn&&(t.nRedOn=1,t.cLight="红灯",t.cClsLight="red"),"True"===e.ZtLeightYelloOn&&(t.nYelloOn=1,t.cLight="黄灯",t.cClsLight="yellow"),t.dWeight=e.ZtWeightValue}},getTrackDateMsg:function(t){var e=t;if(e>864e5){var a=(e/864e5).toFixed(2),i={nTime:a,cMsg:"天"};return i}if(e>36e5&&e<=864e5){var r=(e/36e5).toFixed(2),i={nTime:r,cMsg:"小时"};return i}if(e>6e4&&e<=36e5){var r=(e/6e4).toFixed(0);r<0&&(r=0);var i={nTime:r,cMsg:"分钟"};return i}var r=(e/1e3).toFixed(0);if(r<=0)return{nTime:0,cMsg:""};var i={nTime:r,cMsg:"秒"};return i}},ES.TrackView={},ES.TrackView.Version="0.1.0",ES.TrackView.Config={oEditRoadConfig:{stroke:!0,color:"#FF3300",dashArray:null,lineCap:null,lineJoin:null,weight:3,opacity:1,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1},oRoadConfig:{stroke:!0,color:"#5eb95e",dashArray:null,lineCap:null,lineJoin:null,weight:7,opacity:.8,fill:!1,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1},oSiteConfig:{stroke:!0,color:"#0FFF05",dashArray:null,lineCap:null,lineJoin:null,weight:3,opacity:1,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1},oUnloadConfig:{stroke:!0,color:"#FF3300",dashArray:null,lineCap:null,lineJoin:null,weight:3,opacity:1,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1},oBandConfig:{stroke:!0,color:"#FF3300",dashArray:null,lineCap:null,lineJoin:null,weight:3,opacity:1,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1},oLiveCircleConfig:{stroke:!0,color:"#FF3300",dashArray:null,lineCap:null,lineJoin:null,weight:1,opacity:1,fill:!0,fillColor:null,fillOpacity:.2,clickable:!0,smoothFactor:1,noClip:!1},oLiveCircleMarkerConfig:{fill:!0,fillColor:"#fff",radius:3,weight:1,opacity:1,fillOpacity:1},oTrackPosConfig:{fill:!0,fillColor:"#fff",radius:5,weight:2,opacity:1,fillOpacity:1},oLiveLineConfig:{opacity:1,color:"blue",weight:3}},ES.TrackView.Layout=ES.Evented.extend({oOption:{cContainerSel:".ex-layout-main"},initialize:function(t,e){ES.setOptions(this,e),this._oParent=t,this.initUI(),this.initOn(),this.setParentEvent()},initOn:function(){this._oParent.on("MapView:LayoutContent.resize",this.resize,this)},resize:function(t){t.nWidth&&this.$_oContainer.css({width:t.nWidth}),t.nHeight&&this.$_oContainer.css({height:t.nHeight})},reflesh:function(t,e){this.$_oContainer.css({width:t,height:e})},initUI:function(){this.$_oContainer=r(this.cHtml),r(this.oOption.cContainerSel).append(this.$_oContainer),this.$_oContainer.css({width:this.oOption.nWidth,height:this.oOption.nHeight}),r('input[type="checkbox"]').uCheck(),r('input[type="checkbox"].ec-ucheck-checkbox').uCheck();var t=this;r("#Site").bind("change",function(e){r(this).is(":checked")?ES.Util.reqData({data:{},url:"/Site/SiteInfoForTrack"},function(e){t._oParent.fire("TrackView.SiteLayer:DrawArea",{aoData:e.rtnData})},this):t._oParent.fire("TrackView.SiteLayer:ClearArea")}),r("#Unload").bind("change",function(e){r(this).is(":checked")?ES.Util.reqData({data:{},url:"/Unload/UnloadInfoForTrack"},function(e){t._oParent.fire("TrackView.UnloadLayer:DrawArea",{aoData:e.rtnData})},this):t._oParent.fire("TrackView.UnloadLayer:ClearArea")})},setParentEvent:function(){var t=this.$_oContainer.find(".ex-layout-track-chart").get(0);a.DomEvent.addListener(t,"click",a.DomEvent.stopPropagation),a.DomEvent.addListener(t,"dblclick",a.DomEvent.stopPropagation),a.DomEvent.addListener(t,"mousemove",a.DomEvent.stopPropagation),a.DomEvent.addListener(t,"mousewheel",a.DomEvent.stopPropagation);var t=this.$_oContainer.find(".ex-layout-trackbar").get(0);a.DomEvent.addListener(t,"click",a.DomEvent.stopPropagation),a.DomEvent.addListener(t,"dblclick",a.DomEvent.stopPropagation),a.DomEvent.addListener(t,"mousemove",a.DomEvent.stopPropagation),a.DomEvent.addListener(t,"mousewheel",a.DomEvent.stopPropagation)}}),ES.TrackView.Layout.include({cHtml:'<div class="ex-layout-content">   <div id="MapView" class="ex-layout-map-content">       <div class="ex-layout-maptool ex-theme-maptool ex-map-top ex-map-left"></div>       <div class="ex-layout-maptool ex-theme-maptool ex-map-top ex-map-right">           <div class="ex-layout-trackbar">               <div class="ex-maptool-box" >                   <i class="ec-icon-tachometer"></i>&nbsp;&nbsp;状态               </div>               <div class="ex-maptool-box">                   <i class="ec-icon-line-chart"></i>&nbsp;&nbsp;速度               </div>               <div class="ex-maptool-box" style = "display:none">                   <i class="ec-icon-check-square"></i>&nbsp;&nbsp;顶棚               </div>               <div class="ex-maptool-box" style = "display:none">                   <i class="ec-icon-map-signs"></i>&nbsp;&nbsp;行程               </div>               <div class="ex-maptool-box"  even-name="Track:Bar.dealParkMarkers">                   <i class="ec-icon-get-pocket" ></i>&nbsp;&nbsp;停留               </div>               <div class="ex-maptool-box"  even-name="Track:Bar.dealAlarmMarkers">                   <i class="ec-icon-warning"></i>&nbsp;&nbsp;报警               </div>               <div class="ex-maptool-box" style = "display:none">                   <i class="ec-icon-ils"></i>&nbsp;&nbsp;线路               </div>               <div class="ex-maptool-box pass">                   <i class="ec-icon-area-chart"></i>&nbsp;&nbsp;报表               </div>           </div>       </div>       <div class="ex-layout-maptool ex-theme-maptool ex-map-top ex-map-right" style="top:50px; box-shadow:none;">           <ul class="ex-layout-track-chart chart-width">               <li class="track-chart-box" style="height:145px;overflow:hidden">                   <dl class="ex-layout-track-chart-box">                       <a href="javascript:void(0);" class="ec-close">&times;</a>                       <dt><i class="ec-icon-tachometer"></i>&nbsp;&nbsp;状态</dt>                       <dd>                       <table class="TrackPanel-Tabel">                           <tbody>                               <tr>                                   <td><strong>行驶时长</strong></td>                                       <td class="TrackPanel-emOrStrong ec-text-right" id="total_travelPeriod"></td>                                       <td > &nbsp;&nbsp;<span id="travelPeriod_msg"></span></td>                                       <td><strong>行驶里程</strong></td>                                       <td class="TrackPanel-emOrStrong ec-text-right" id="total_mileage"></td>                                       <td> &nbsp;&nbsp;Km</td>                               </tr>                               <tr>                                   <td><strong>平均速度</strong></td>                                   <td class="TrackPanel-emOrStrong ec-text-right" id="total_avgSpeed"></td>                                   <td> &nbsp;&nbsp;Km/h</td>                                   <td><strong>轨迹点</strong></td>                                   <td class="TrackPanel-emOrStrong ec-text-right" id="total_points"></td>                                   <td>&nbsp;&nbsp;个</td>                               </tr>                               <tr>                                   <td><strong>开始时间</strong></td>                                   <td colspan="5" class="TrackPanel-emOrStrong" id="tdBeginDate" style="text-align:center;"></td>                                   <td></td>                               </tr>                               <tr>                                       <td><strong>结束时间</strong></td>                                   <td colspan="5" class="TrackPanel-emOrStrong" id="tdEndDate" style="text-align:center;"></td>                                   <td></td>                               </tr>                           </tbody>                       </table>                   </dd>               </dl>           </li>           <li class="track-chart-box">               <dl class="ex-layout-track-chart-box" style="max-height:340px;padding:0;">                   <a href="javascript:void(0);" class="ec-close">&times;</a>                   <dt><i class="ec-icon-line-chart"></i>&nbsp;&nbsp;速度</dt>                   <dd  style="max-height:340px">                       <div id="speedWeightDoorChartView">                           <div id="divSpeedWeightChart" style="width:380px;height:300px"> </div>                       </div>                   </dd>               </dl>           </li>           <li class="track-chart-box">               <dl class="ex-layout-track-chart-box">                   <a href="javascript:void(0);" class="ec-close">&times;</a>                   <dt><i class="ec-icon-check-square"></i>&nbsp;&nbsp;顶棚</dt>                   <dd>                       <div id="speedChartsView"></div>                   </dd>               </dl>           </li>           <li class="track-chart-box">               <dl class="ex-layout-track-chart-box">                   <a href="javascript:void(0);" class="ec-close">&times;</a>                   <dt><i class="ec-icon-map-signs"></i>&nbsp;&nbsp;行程</dt>                   <dd>                       <div id="runChartsView"></div>                   </dd>               </dl>           </li>           <li class="track-chart-box">               <dl class="ex-layout-track-chart-box">                   <a href="javascript:void(0);" even-name="Track:Bar.dealParkMarkers" class="ec-close">&times;</a>                   <dt><i class="ec-icon-get-pocket"></i>&nbsp;&nbsp;停留</dt>                   <dd>                       <div id="parkChartView"></div>                   </dd>               </dl>           </li>           <li class="track-chart-box" style="height:260px;padding:0 !important">               <dl class="ex-layout-track-chart-box">                   <a href="javascript:void(0);" even-name="Track:Bar.dealAlarmMarkers" class="ec-close">&times;</a>                   <dt><i class="ec-icon-warning"></i>&nbsp;&nbsp;报警</dt>                   <ul class="alarm-type">                       <li class="active" cid="">全部</li>                   </ul>                   <dd>                       <div id="alarmChartView"></div>                   </dd>               </dl>           </li>           <li class="track-chart-box">               <dl class="ex-layout-track-chart-box">                   <a href="javascript:void(0);" class="ec-close">&times;</a>                   <dt><i class="ec-icon-ils"></i>&nbsp;&nbsp;线路</dt>                   <dd>                       <div id="speedChartsView"></div>                   </dd>               </dl>           </li>           <li class="track-chart-box"></li>       </ul>    </div>               <div id="echartsSpeed" class="echarts_box speed" style="right:0; left:inherit;bottom: 20px;"></div>   </div>   <div class="ex-layout-trackcontrol " style="width:450px">       <div class="track-control-box slideup">           <ul class="ex-layout-trackcontrol-query">               <li class="ec-form-group ec-form-select ec-form-icon">                   <label class=" ec-checkbox-inline ec-success"><input type="checkbox" checked  class="ckbPopup"/>气泡</label>               </li>               <li class="ec-form-group ec-form-select ec-form-icon">                   <label  class=" ec-checkbox-inline ec-success"><input type="checkbox" checked class="ckbTrackLine" />轨迹线</label>               </li>               <li class="ec-form-group ec-form-select ec-form-icon">                   <label  class=" ec-checkbox-inline ec-success"><input type="checkbox" class="ckbTrackPos"/>轨迹点</label>               </li>               <li class="ec-form-group">                   <label  class="ec-checkbox-inline ec-success" id="VehNo"> </label>               </li>               <li class="ec-form-group ec-form-select ec-form-icon" style="float:right;">                   <i class="ec-icon-line-chart"></i>                   <select class="ec-form-field ec-handle-playSpeed">                       <option value="50">播放速度[极速]</option>                       <option value="100">播放速度[快速]</option>                       <option value="200">播放速度[较快]</option>                       <option value="500">播放速度[一般]</option>                       <option value="1000">播放速度[慢速]</option>                   </select>               </li>           </ul>           <ul class="ex-layout-trackcontrol-console">               <li>                   <button class="ec-btn ec-btn-secondary ec-radius track-play" style="width:4rem"><i class="ec-icon-play"></i></button>                   <button class="ec-btn ec-btn-secondary ec-radius track-pause" style="width:4rem;display:none;"><i class="ec-icon-pause"></i></button>               </li>               <li>                   <button class="ec-btn ec-btn-secondary ec-radius track-replay"><i class="ec-icon-repeat"></i></button>               </li>               <li style="margin-right: inherit;">                   <div class="track-control-slider" data-range_min="0" data-range_max="100" data-cur_min="100" data-cur_max="0">                       <div class="track-control-bar"></div>                       <div class="track-control-leftGrip"></div>                   </div>                   <ul class="track-control-label"></ul>               </li>            </ul>       </div>       <ul class="ex-layout-trackcontrol-search">           <li class="ec-form-group">               <label>查找轨迹：</label>           </li>           <ul class="ex-datetime-box ec-avg-sm-2">               <li class="ec-form-group">                   <label for="form-dateStart" class="ec-form-label">开始时间：</label>                   <div class="ec-input-group ec-input-group-sm date ec-form-datetime">                       <input size="16" type="text" id="txtBeginDate" value="2015-02-14 14:45" class="ec-form-field">                           <span class="ec-input-group-label add-on"><i class="icon-th ec-icon-calendar"></i></span>                   </div>               </li>               <li class="ec-form-group">                   <label for="form-dateEnd" class="ec-form-label">结束时间：</label>                   <div class="ec-input-group ec-input-group-sm date ec-form-datetime">                       <input size="16" type="text" id="txtEndDate" value="2015-02-14 14:45" class="ec-form-field">                       <span class="ec-input-group-label add-on"><i class="icon-th ec-icon-calendar"></i></span>                   </div>               </li>           </ul>           <li class="ec-form-group ec-form-select ec-form-icon">               <i class="ec-icon-clock-o"></i>               <select class="ec-form-field ec-handle-time">                   <option value="1">最近1小时</option>                   <option value="3">最近3小时</option>                   <option value="6">最近6小时</option>                   <option value="12">最近半天</option>                   <option value="24">最近1天</option>                   <option value="72">最近3天</option>                   <option value="0">手动选择</option>               </select>           </li>           <li class="ec-form-group ec-form-select ec-form-icon">               <i class="ec-icon-line-chart"></i>               <select class="ec-form-field ec-handle-speed">                   <option value="0">0km/h</option>                   <option value="2">2km/h以内</option>                   <option value="5">5km/h以内</option>                   <option value="10">10km/h以内</option>                   <option value="60">60km/h以内</option>                   <option value="80">80km/h以内</option>                   <option value="-1">不屏蔽</option>               </select>           </li>           <li class="ec-form-group">               <button class="ec-btn ec-btn-sm ec-btn-success track-search"><i class="ec-icon-search"></i> 查询轨迹</button>           </li>       </ul>    </div></div>'}),ES.TrackView.Page=ES.Page.extend({oReqUrl:{oStatusUrl:{cUrl:null,cType:"api"},oTrackUrl:{cUrl:"http://180.101.255.219:38009/jt808web/table/monitor/getTrackDev",cType:"api",PageSize:300,PageIndex:1},oAlarmUrl:{cUrl:"http://api.bdlbs.comlbs.com/bb/map/UserAlarm",cType:"api"},oCenterPOIUrl:{cUrl:"http://61.136.223.44:8002/../api/util/GetPointRegion",cType:"api"}},getUrl:function(t){var e=this.oReqUrl[t];return e?e.cUrl:""},initialize:function(e,a){ES.Page.prototype.initialize.call(this,e,a),this.initEvent(),r(".ex-layout-track-chart").stop().animate({"max-height":r(t).height()-275+"px"},500);var i=t.location.href;this.oWinUrl=this.getArgs(i),this.oWinUrl.token="8272209733a142c9b7851e6d744e1232"},initEvent:function(){},getEvenName:function(t){return this.oEvenName[t]},oEvenName:{firstReqTrackBC:"TrackView:TrackData:firstReqTrackBC",play:"TrackView:Control.Play",noticeTimerPlay:"TrackView:TrackPos.noticeTimerPlay",playFinish:"TrackView:TrackPos.playFinish",pause:"TrackView:Contorl.pause",nextReq:"TrackView:TrackData.timerReqTrack",sliderReq:"TrackView:TrackData.sliderReq",setPlaySpeed:"TrackView:TrackPos.setPlaySpeed",setTrackClass:"TrackView:Control.setTrackClass",setPosClass:"TrackView:Control.setPosClass",setPopupOpen:"TrackView:Control.setPopupOpen",setToFront:"TrackView:TrackArrow.setToFront",drawParkMarker:"TrackView:Penal.drawParkMarker",localParkMarker:"TrackView:Penal.localParkMarker",setParkData:"TrackView:Penal.setParkData",drawAlarmMarker:"TrackView:Penal.drawAlarmMarker",localAlarmMarker:"TrackView:Penal.localAlarmMarker",setAlarmData:"TrackView:Penal.setAlarmData",clearMap:"Track:Cotrol.clearMap"},getArgs:function(t){var e=location.search.substring(1);t||(e=t);for(var a={},i=e.split("&"),r=0;r<i.length;r++){var n=i[r].indexOf("=");if(-1!==n){var o=i[r].substring(0,n),s=i[r].substring(n+1);s=decodeURIComponent(s),a[o]=s}}return a},getDevNo:function(){return this.oWinUrl.PhoneNum},getToken:function(){return this.oWinUrl.token},getLatLngs:function(){if(this.oWinUrl.LeftTop&&this.oWinUrl.RightBottom){var t=this.oWinUrl.LeftTop.split(","),e=this.oWinUrl.RightBottom.split(","),a=parseFloat(t[0]),i=parseFloat(t[1]),r=parseFloat(e[0]),n=parseFloat(e[1]);return[{lat:i,lng:a},{lat:i,lng:r},{lat:n,lng:r},{lat:n,lng:a}]}},getSusUnloadLatLngs:function(){if(this.oWinUrl.UnloadLeftTop&&this.oWinUrl.UnloadRightBottom){var t=this.oWinUrl.UnloadLeftTop.split(","),e=this.oWinUrl.UnloadRightBottom.split(","),a=parseFloat(t[0]),i=parseFloat(t[1]),r=parseFloat(e[0]),n=parseFloat(e[1]);return[{lat:i,lng:a},{lat:i,lng:r},{lat:n,lng:r},{lat:n,lng:a}]}},getVehNo:function(){return this.oWinUrl.VehicleNo},getSiteId:function(){return this.oWinUrl.SiteId},getUnloadId:function(){return this.oWinUrl.UnloadId}}),ES.TrackView.Page.include({trackSearch:function(){this.GetQueryString("nBTick")&&r(".track-search").click()},GetQueryString:function(e){var a=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=t.location.search.substr(1).match(a);return null!=i?unescape(i[2]):null}}),ES.TrackView.Bar=ES.Class.extend({oOption:{cEvenShowBox:"TrackView:TrackChart.showBox"},initialize:function(t,e){this._oParent=t,ES.setOptions(this,e),this.$_oBar=r(".ex-layout-trackbar"),this.initEven()},initEven:function(){var t=this;this.$_oBar.find(".ex-maptool-box:not(.pass.passCheck)").bind("click",function(){var e={nIndex:r(this).index(),bIsShow:!1};t._oParent.fire(t.oOption.cEvenShowBox,{oBox:e});var a=e.bIsShow?"#5e7aea":"#3bb4f2",i=r(this).attr("even-name");i&&t._oParent.fire(i,{bIsDraw:!e.bIsShow}),r(this).css("background-color",a)})}}),ES.TrackView.Control=ES.Class.extend({initialize:function(t,e){ES.setOptions(this,e),this._oParent=t,this.initControl(),this.initEvent(),this.initOn()},searchTrack:function(){},initEvent:function(){r("#txtBeginDate").val(ES.Util.dateFormat((new Date).getTime()-36e5,"yyyy-MM-dd hh:mm:ss")),r("#txtEndDate").val(ES.Util.dateFormat((new Date).getTime(),"yyyy-MM-dd hh:mm:ss")),r(".ec-form-datetime").datetimepicker({language:"zh-CN",format:"yyyy-mm-dd hh:ii:ss",autoclose:!0,todayBtn:!0,pickerPosition:"top-left"}),r(".ec-handle-time").bind("click",function(){"0"==r(this).val()?r(".ex-datetime-box").show():r(".ex-datetime-box").hide()}),this.initSearchEven(),this.initPlayEven(),this.initPlaySpeedEven(),this.initReplay(),this.initCkbEven()},initSearchEven:function(){var t=this;r(".track-search").bind("click",function(){t._oParent.fire("TV:firstReqTrack"),t._oParent.fire(t._oParent.getEvenName("clearMap")),t.backStatus()})},initControl:function(){var t=[1,2],e=t.length;r(".track-control-label").addClass("ec-avg-sm-"+e);for(var a=0;a<=e-1;a++)r(".track-control-label").append("<li>"+t[a]+"</li>");r(".track-control-label > li:first-child").html('<span class="ec-align-left">起</span>'),r(".track-control-label > li:last-child").html("终");var i=this;r(".track-control-slider").attr({"data-range_max":100,"data-cur_min":0}).nstSlider({left_grip_selector:".track-control-leftGrip",value_bar_selector:".track-control-bar",user_mouseup_callback:function(t,e,a){i._oParent.fire("Track:moveSliderCursor",{nIndex:t}),i._oParent.on("Track:setSliderCursor",i.setSliderCursor,i)},user_drag_start_callback:function(t,e,a){i._oParent.off("Track:setSliderCursor",i.setSliderCursor,i)}}),r("#VehNo").html(this._oParent.getVehNo())},initSlider:function(t){if(!t||!t.hasOwnProperty("nTotalPage"))return void console.log(ESLang.TrackView.Contorl[1]);this.setCursor(0),r(".ex-datetime-box").hide(),r(".track-control-box").show().addClass("in")},initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.firstReqTrackBC,this),this._oParent.on(this._oParent.getEvenName("playFinish"),this.playFinish,this),this._oParent.on(this._oParent.getEvenName("noticeTimerPlay"),this.setSliderCursor,this),this._oParent.on("Track:setSliderCursor",this.setSliderCursor,this),this._oParent.getSearchTime=this.getSearchTime,this._oParent.getSearchSpeed=this.getSearchSpeed,this._oParent.getCkbStatus=this.getCkbStatus},setSliderCursor:function(t){this.setCursor(t.nIndex)},setCursor:function(t){r(".track-control-slider").nstSlider("set_position",t)},firstReqTrackBC:function(t){if(t.nTotalPage<=0)return void ES.aWarn("没有查询到车辆的历史轨迹！");var e=t.aoTrack;(!e||e.length<=0)&&ES.aWarn("当前车辆停留，请播放轨迹，查看轨迹数据！"),this.initSlider(t)},getSearchTime:function(){var t=parseInt(r(".ec-handle-time").val()),e=0,a=0;return 0===t?(e=r("#txtBeginDate").val(),a=r("#txtEndDate").val()):(a=(new Date).getTime(),e=a-60*t*60*1e3),{EndTime:ES.Util.dateFormat(a,"yyyy-MM-dd hh:mm:ss"),StartTime:ES.Util.dateFormat(e,"yyyy-MM-dd hh:mm:ss")}},getSearchSpeed:function(){return parseInt(r(".ec-handle-speed").val())},getCkbStatus:function(){var t={bIsPopup:!1,bIsTrackLine:!1,bIsTrackPos:!1};return t.bIsPopup=r("ul.ex-layout-trackcontrol-query").find("input.ckbPopup").is(":checked"),t.bIsTrackLine=r("ul.ex-layout-trackcontrol-query").find("input.ckbTrackLine").is(":checked"),t.bIsTrackPos=r("ul.ex-layout-trackcontrol-query").find("input.ckbTrackPos").is(":checked"),t},initPlayEven:function(){var t=this;r(".track-play").bind("click",function(){r(this).hide(),r(".track-pause").show(),t._oParent.fire(t._oParent.getEvenName("play"))}),r(".track-pause").bind("click",function(){r(this).hide(),r(".track-play").show(),t._oParent.fire(t._oParent.getEvenName("pause"))})},playFinish:function(t){r(".track-pause").hide(),r(".track-play").show()},backStatus:function(){r(".track-pause").hide(),r(".track-play").show()},notBackStatus:function(){r(".track-pause").show(),r(".track-play").hide()},initPlaySpeedEven:function(){var t=this;r(".ec-handle-playSpeed").bind("change",function(){t._oParent.fire(t._oParent.getEvenName("setPlaySpeed"),{nSpeed:parseInt(r(this).val())})})},initReplay:function(){var t=this;r(".track-replay").bind("click",function(){t.notBackStatus(),t._oParent.fire(t._oParent.getEvenName("sliderReq"),{nPage:0})})},initCkbEven:function(){var t=this;r("ul.ex-layout-trackcontrol-query").find("input.ckbTrackLine").bind("click",function(){t._oParent.fire(t._oParent.getEvenName("setTrackClass"))}),r("ul.ex-layout-trackcontrol-query").find("input.ckbTrackPos").bind("click",function(){t._oParent.fire(t._oParent.getEvenName("setPosClass"))}),r("ul.ex-layout-trackcontrol-query").find("input.ckbPopup").bind("click",function(){t._oParent.fire(t._oParent.getEvenName("setPopupOpen"))})}}),ES.TrackView.TrackChart=ES.Class.extend({oOption:{cJTab:".ex-layout-track-chart > li.track-chart-box",cEvenShowBox:"TrackView:TrackChart.showBox"},initialize:function(t,e){this._oParent=t,ES.setOptions(this,e),this.$_oTab=r(this.oOption.cJTab),this.initEven(),this.initOn()},initOn:function(){this._oParent.on(this.oOption.cEvenShowBox,this.showBox,this)},showBox:function(t){if(t&&t.oBox&&!isNaN(t.oBox.nIndex)){var e=this.$_oTab.eq(t.oBox.nIndex);"none"===e.css("display")?(t.oBox.bIsShow=!1,e.slideDown()):(e.slideUp(),t.oBox.bIsShow=!0)}},initEven:function(){var t=this;r(".ex-layout-track-chart-box > a.ec-close").bind("click",function(){var e=r(this).closest("li.track-chart-box"),a=r('.ex-layout-trackbar > .ex-maptool-box:not(".pass")').eq(e.index());e.slideUp(),a.css("background-color","#5e7aea");var i=r(this).attr("even-name");i&&t._oParent.fire(i,{bIsDraw:!0})})}}),ES.TrackView.TrackData=ES.Class.extend({initialize:function(t,e){this._oParent=t,ES.setOptions(this,e),this.cUrl=t.getUrl("oTrackUrl"),this.aoTrack=new Array,this.m_oTrack={},this.nPage=0,this.m_oTrackInfo={nTotalCnt:0,nTotalPage:0,nPageSize:100,nPage:0},this.initOn()},initOn:function(){this._oParent.on(this._oParent.getEvenName("nextReq"),this.timerReqTrack,this),this._oParent.on("TV:sliderQueryTrack",this.sliderQueryTrack,this),this._oParent.on("TV:firstReqTrack",this.firstReqTrack,this),this._oParent.on(this._oParent.getEvenName("sliderReq"),this.sliderReq,this)},getReqParam:function(){var t=this._oParent.getSearchTime();return!!t&&(this.oReqParam={devNo:this._oParent.getDevNo(),startTime:t.StartTime,endTime:t.EndTime},!0)},firstReqTrack:function(){this.getReqParam()&&(delete this.m_oTrack,this.m_oTrack={},this.m_oTrackInfo={nTotalCnt:0,nTotalPage:0,nPageSize:100,nPage:0},this.aoTrack.splice(0,this.aoTrack.length),this.nPage=1,ES.loadAn("body"," "),ES.getData(JSON.stringify(this.oReqParam),this.cUrl,this.fristCallBack,this,null,{headers:{token:this._oParent.getToken(),"Content-Type":"application/json; charset=utf-8"}}))},fristCallBack:function(t){if(!t||!t.detail)return ES.removeAn("body"," "),void ES.aWarn("没有查询到历史轨迹！");var e=this.reqTrackCallBack(t);this._oParent.fire(this._oParent.getEvenName("firstReqTrackBC"),e)},formatTime:function(t){function e(t){return t<10?"0"+t:t}var a=new Date(parseInt(t)),i=a.getFullYear(),r=a.getMonth()+1,n=a.getDate(),o=a.getHours(),s=a.getMinutes(),l=a.getSeconds();return i+"-"+e(r)+"-"+e(n)+" "+e(o)+":"+e(s)+":"+e(l)},handleTrackData:function(t){var e=this;for(var a in t)t[a].Speed=t[a].speed,t[a].PhoneNum=t[a].mobile,t[a].CompanyName=t[a].deptName,t[a].Direction=parseInt(t[a].direction),t[a].FrontDoor="0"==t[a].frontDoor,t[a].VehicleNo=t[a].vehNo,t[a].GpsDateTime=this.formatTime(t[a].time),t[a].GpsTime=t[a].time,t[a].Mileage=t[a].mileage,t[a].Status=t[a].status,t[a].Acc="0"==t[a].accStatus,t[a].Poi=e.getPoiAddress(t[a].latLng),t[a].Poi.GeoPoint={},t[a].Poi.GeoPoint.Lon=t[a].latLng.lng,t[a].Poi.GeoPoint.Lat=t[a].latLng.lat;return t},getPoiAddress:function(t){var e=this,a={location:t.lng+","+t.lat},i={};return r.ajax({url:"http://180.101.255.219:38009/jt808web/table/map/getRegeo",data:JSON.stringify(a),type:"POST",async:!1,dataType:"json",headers:{token:e._oParent.getToken(),"Content-Type":"application/json; charset=utf-8"},success:function(t){i.Address=t.detail.regeocode.formatted_address}}),i},reqTrackCallBack:function(t){ES.removeAn("body"," ");for(var e=(this._oParent.getSearchSpeed(),[]),a=[],i=this.handleTrackData(t.detail),r=i.length-1;r>=0;r--)i[r].Lng=i[r].latLng.lng,i[r].Lat=i[r].latLng.lat,a.push(i[r]),e.push(i[r]);return this.m_oTrack[1]=a,{aoTotalTrack:e,aoTrack:a,aoPageTrack:a,nPage:1,nTotalPage:1}},timerReqTrack:function(){var t=this.oReqParam.page;return t>this.m_oTrackInfo.nTotalPage?(this._oParent.fire(this._oParent.getEvenName("playFinish"),{nPage:t}),void ES.aWarn("历史轨迹播放完毕！")):this.m_oTrack.hasOwnProperty(t)?(this._oParent.fire(this._oParent.getEvenName("noticeTimerPlay"),{aoTrack:this.aoTrack,aoPageTrack:this.m_oTrack[t],nPage:t,nTotalPage:this.m_oTrackInfo.nTotalPage}),void(this.oReqParam.page=t+1)):(ES.loadAn("body"),void ES.getData(JSON.stringify(this.oReqParam),this.cUrl,this.timerReqCallBack,this,null,{headers:{token:this._oParent.getToken(),
"Content-Type":"application/json; charset=utf-8"}}))},timerReqCallBack:function(t){if(!t||!t.DataList||t.DataList.length<=0)return ES.removeAn("body"," "),void ES.aWarn("没有查询到历史轨迹！");this.ReqTrackCallBack(t),this._oParent.fire(this._oParent.getEvenName("noticeTimerPlay"),{aoTrack:this.aoTrack,aoPageTrack:t.DataList,nPage:t.page,nTotalPage:this.m_oTrackInfo.nTotalPage})},sliderReq:function(t){var e=t.nPage+1;if(this.m_oTrack.hasOwnProperty(e))return this._oParent.fire(this._oParent.getEvenName("noticeTimerPlay"),{aoTrack:this.aoTrack,aoPageTrack:this.m_oTrack[e],nPage:e,nTotalPage:this.m_oTrackInfo.nTotalPage}),void(this.oReqParam.page=e+1);this.oReqParam.page=e,ES.loadAn("body"),ES.getData(JSON.stringify(this.oReqParam),this.cUrl,this.sliderReqCallBack,this,null,{headers:{token:this._oParent.getToken(),"Content-Type":"application/json; charset=utf-8"}})},sliderReqCallBack:function(t){if(!t||!t.detail||!t.detail.DataItems||t.detail.DataItems.length<=0)return ES.removeAn("body"," "),void ES.aWarn("没有查询到历史轨迹！");this.ReqTrackCallBack(t),this._oParent.fire(this._oParent.getEvenName("noticeTimerPlay"),{aoTrack:this.aoTrack,aoPageTrack:t.DataList,nPage:t.page,nTotalPage:this.m_oTrackInfo.nTotalPage})}}),ES.TrackView.HistoryTrack=ES.Class.extend({oOption:{nTrackWinWidth:1e3,nTrackWinHeight:500},_aoHistoryTrackData:[],initialize:function(t,e,a){this._oParent=t,e=ES.setOptions(this,e),this.initEvent(),this.initOn()},initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.fristHandler,this),this._oParent.on(this._oParent.getEvenName("noticeTimerPlay"),this.setAllTrackInfo,this)},initEvent:function(){var t=this;r(".ex-layout-trackbar .ex-maptool-box.pass").bind("click",function(){t.historyTrackWindow()})},msg:function(){return'<div class="ex-layout-warning-grid-box"><div style="float:left;width:80%"></div><div style="float:right;width:60px"></div><div id="dtHistoryTrackContainer" class="dt-grid-container" style="width:100%;max-height:400px;clear:both"></div><div id="historyTracGrdTbar" class="dt-grid-toolbar-container"></div></div>'},historyTrackWindow:function(){this.oWnd||(this.oWnd=this.getWnd(),this.initGrid()),this.oWnd.show()},getWnd:function(){var t=this;return dialog({fixed:!0,align:"right bottom",title:"历史轨迹",content:this.msg(),width:this.oOption.nTrackWinWidth,button:[{value:"导出数据",callback:function(){return t.exportGrid(),!1},autofocus:!0}],onclose:function(){t.oWnd=null}})},exportGrid:function(){var e=this._oParent.oWinUrl,a=this._oParent.getSearchTime(),i=a.StartTime,r=a.EndTime,n=e.PhoneNum,o=e.VehicleNo,s=this._oParent.getSearchSpeed();t.location.href="http://api.bdlbs.comlbs.com/bb/reports/export/HisLocExport?StartTime="+i+"&EndTime="+r+"&PhoneNums_parms="+n+"&VehicleNo="+o+"&IsGpsTimeDesc="+-1+"&MinSpeed="+s},initGrid:function(){var t={lang:"zh-cn",ajaxLoad:!1,datas:this._aoHistoryTrackData,columns:this.getDtGridColumns(),gridContainer:"dtHistoryTrackContainer",toolbarContainer:"historyTracGrdTbar",tools:"",pageSize:10,pageSizeLimit:[10,20,30,50],onSelectRow:function(t,e,a){var i=r(this).data("oData").dataList[parseInt(t)-1];self.initClick(a,i)}};(this.oAlarmGrid=r.fn.DtGrid.init(t)).load()},getDtGridColumns:function(){return[{id:"VehicleNo",title:"车牌",columnClass:"ec-text-center"},{id:"CompanyName",title:"企业",columnClass:"ec-text-center"},{id:"Speed",title:"速度(Km/h)",columnClass:"ec-text-center"},{id:"Direction",title:"方向",columnClass:"ec-text-center"},{id:"Mileage",title:"累积里程(Km)",columnClass:"ec-text-center"},{id:"Lng",title:"经度",columnClass:"ec-text-center"},{id:"Lat",title:"纬度",columnClass:"ec-text-center"},{id:"PoiInfo",title:"位置",columnClass:"ec-text-center"},{id:"GpsTime",title:"定位时间",columnClass:"ec-text-center"}]},initClick:function(t,e){},fristHandler:function(t){this._aoHistoryTrackData&&this._aoHistoryTrackData.length>=0&&this._aoHistoryTrackData.splice(0,this._aoHistoryTrackData.length);var e=this.convertData(t);r.merge(this._aoHistoryTrackData,e),this.oAlarmGrid&&this.oAlarmGrid.reload(!0)},setAllTrackInfo:function(t){var e=this.convertData(t);r.merge(this._aoHistoryTrackData,e),this.oAlarmGrid&&this.oAlarmGrid.reload(!0)},convertData:function(t){return t.aoPageTrack.map(function(t){var e={};return e.VehicleNo=t.VehicleNo,e.CompanyName=t.CompanyName,e.Direction=ES.TrackHelper.getDire(t.Direction),e.Mileage=(.001*t.Mileage).toFixed(2),e.Lng=t.Poi.GeoPoint.Lon,e.Lat=t.Poi.GeoPoint.Lat,e.GpsTime=t.GpsDateTime,e.Speed=t.Speed,e.PoiInfo=t.Poi.Address,e})}}),ES.TrackView.AlarmTrack=a.MapLib.MapMaster.MapOpr.extend({oOption:{trackConfig:{color:"orange",opacity:1}},initialize:function(t,e){a.MapLib.MapMaster.MapOpr.prototype.initialize.call(this,t,e),ES.setOptions(this,e),this._oParent=t,this.cUrl=this._oParent.getUrl("oTrackUrl"),this.initLayer(),this.initOn()},initLayer:function(){this._oAlarmLayerGroup=new a.featureGroup,this._oAlarmLayerGroup.addTo(this._oMap)},initOn:function(){this._oParent.on(this._oParent.getEvenName("localAlarmMarker"),this.getReqParam,this),this._oParent.on("ES.MapOpr.TrackView.TrackArrow: moveend",this.bringToTop,this),this._oParent.on("Track:Bar.dealAlarmMarkers",this.closeWindow,this)},bringToTop:function(){this._oAlarmLayerGroup&&this._oAlarmLayerGroup.bringToFront()},getReqParam:function(t){var e=this.getSearchTime(t);if(!e)return!1;this.oReqParam={StartTime:"2000-01-01",EndTime:"2000-01-02",PhoneNum:m_PhoneNum,MinSpeed:this._oParent.getSearchSpeed(),PageSize:800,PageIndex:1},ES.extend(this.oReqParam,e),this.getAlarmTrack()},getSearchTime:function(t){var e=1e3*t.oItem.AlarmStartTimeStamp,a=1e3*t.oItem.LastUpdateTimeStamp,i=ES.Util.dateFormat(e,"yyyy-MM-dd hh:mm:ss");return{nBeginT:e,nEndT:a,EndTime:ES.Util.dateFormat(a,"yyyy-MM-dd hh:mm:ss"),StartTime:i}},getAlarmTrack:function(){ES.getData(JSON.stringify(this.oReqParam),this.cUrl,this.fnCallBack,this)},fnCallBack:function(t){this.clearMap();var e=t.dataList.map(function(t){return[t.Poi.MapPoint.Lat,t.Poi.MapPoint.Lon]});a.polyline(e,this.oOption.trackConfig).addTo(this._oAlarmLayerGroup)},closeWindow:function(t){t.bIsDraw||this.clearMap()},clearMap:function(){this._oAlarmLayerGroup.clearLayers()}}),ES.TrackView.PanelBox={},ES.TrackView.PanelBox.BasePanel=ES.Class.extend({}),ES.TrackView.PanelBox.AlarmPanel=ES.TrackView.PanelBox.BasePanel.extend({oOption:{cAlarmDiv:"alarmChartView"},initialize:function(t,e){ES.setOptions(this,e),this._oParent=t,this.initOn()},initAlarmTypeUI:function(){r("ul.alarm-type").empty();var t={searchModel:{menu_id:1892},buttonId:1,pageIndex:1,pageSize:10};ES.getData(JSON.stringify(t),this._oParent.getUrl("oAlarmUrl"),function(t){if(t&&1===t.code&&t.detail&&!(t.detail.length<=0)){t.detail.unshift({dicKey:"",remark:"全部"});for(var e=0;e<t.detail.length;e++){var a=t.detail[e];a.cCls="",0===e&&(a.cCls="active");var i=r(ES.template('<li cid="{dicKey}" class="{cCls}">{remark}</li>',a));r("ul.alarm-type").append(i)}}},this,null,{headers:{token:this._oParent.getToken(),"Content-Type":"application/json; charset=utf-8"}})},initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.initUI,this),this._oParent.on(this._oParent.getEvenName("clearMap"),this.clearMap,this)},clearMap:function(){r("#"+this.oOption.cAlarmDiv).empty()},getReqParam:function(){var t=this._oParent.getSearchTime();return!!t&&(this.oReqParam={searchModel:{menu_id:1892,startTime:t.StartTime,endTime:t.EndTime,devNo:this._oParent.getDevNo()},buttonId:2,pageIndex:1,pageSize:200},!0)},initUI:function(){this.getReqParam()&&this._oParent.getUrl("oAlarmUrl")&&(ES.loadAn(this.oOption.cAlarmDiv,"#"),this.initAlarmTypeUI(),ES.getData(JSON.stringify(this.oReqParam),this._oParent.getUrl("oAlarmUrl"),this.InitUIHandler,this,null,{headers:{token:this._oParent.getToken(),"Content-Type":"application/json; charset=utf-8"}}))},InitUIHandler:function(t){if(!t||t.length<=0)return void ES.removeAn("body"," ");for(var e=t,a=0;a<e.length;a++)e[a].nIndex=a;this._oParent.fire(this._oParent.getEvenName("setAlarmData"),{aoAlarm:e}),this.initDataAlarm(e),"none"!==r("#"+this.oOption.cAlarmDiv).parent().parent().css("display")&&this._oParent.fire("Track:Bar.dealAlarmMarkers",{bIsDraw:!1})},initDataAlarm:function(t){var e=this;if(t&&!(t.length<=0)){for(var a=t,i=r("#"+this.oOption.cAlarmDiv).empty(),n=0;n<a.length;n++)ES.Util.initTag(i,this.getAlarmConfig(a[n])),r("div.alarmRecord[cId='"+a[n].nIndex+"']").data("oItem",{oItem:a[n]});r(".alarmRecord").bind("click",this,function(t){var a=r(this).data("oItem");e._oParent.fire(e._oParent.getEvenName("localAlarmMarker"),a),r(this).removeClass("selected"),r(this).addClass("selected")})}},getAlarmConfig:function(t){return oRunConfig={div:{class:"TrackPanel-mRow TrackPanel-hoverRow alarmRecord",cId:t.nIndex,span:[{class:"TrackPanel-icon over-speed"},{class:"TrackPanel-emOrStrong",html:"["+ES.TrackHelper.getAlarmTypeName(t.AlarmType)+"]"},{html:t.AlarmPoi.Address+"</br>"},{html:"时间："+ES.Util.dateFormat(1e3*t.AlarmTime,"yyyy-MM-dd hh:mm")},{html:"到"+ES.Util.dateFormat(1e3*(t.AlarmTime+60*t.ContinueTime),"yyyy-MM-dd hh:mm")},{html:"("+t.ContinueTime+"分)"}]}},oRunConfig}}),ES.TrackView.PanelBox.AlarmPanel.include({alarmFilter:function(){var t=this;r(".alarm-type>li").click(function(){r(".alarm-type>li").removeClass("active"),r(this).addClass("active");var e=r(this).text();t.selectAlarmTyle(e)})},selectAlarmTyle:function(t){if("全部"==t)r(".alarmRecord").css("display","block");else for(var e=r(".alarmRecord").siblings(),a=0;a<e.length;a++){var i=ES.TrackHelper.getAlarmTypeName(r(e[a]).data("oItem").oItem.AlarmType);-1!=i.indexOf(t)?r(r(".alarmRecord")[a]).css("display","block"):r(r(".alarmRecord")[a]).css("display","none")}}}),ES.TrackView.PanelBox.ParkPanel=ES.TrackView.PanelBox.BasePanel.extend({oOption:{cParkDiv:"parkChartView",cRunDiv:"runChartsView"},initialize:function(t,e){ES.setOptions(this,e),this._oParent=t,this.initOn()},initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.initUI,this),this._oParent.on(this._oParent.getEvenName("clearMap"),this.clearMap,this)},clearMap:function(){this.clearPark(),this.clearRun(),this.clearReport()},getReqParam:function(){var t=this._oParent.getSearchTime();return!!t&&(this.oReqParam={StartTime:"2000-01-01",EndTime:"2000-01-02",PhoneNum:m_PhoneNum,MinSpeed:this._oParent.getSearchSpeed(),PageSize:100,PageIndex:1},ES.extend(this.oReqParam,t),!0)},initUI:function(t){if(this.clearReport(),t&&t.aoTotalTrack&&!(t.aoTotalTrack.length<=0)){var e=t.aoTotalTrack,a=[],r=null;for(i=0;i<e.length;i++)if(e[i].Speed<=0){if(r){i==e.length-1&&a.push({cBeginDate:r.GpsDateTime,oBeginPos:r.Poi.MapPoint,cBeginAddr:r.Poi.Address,cEndDate:e[i].GpsDateTime,oEndPos:e[i].Poi.MapPoint,cEndAddr:e[i].Poi.Address,nIndex:n});continue}r=e[i]}else{if(!r)continue;if(ES.Util.toDate(e[i].GpsDateTime).getTime()-ES.Util.toDate(r.GpsDateTime).getTime()>=12e4){var n=a.length;a.push({cBeginDate:r.GpsDateTime,oBeginPos:r.Poi.MapPoint,cBeginAddr:r.Poi.Address,cEndDate:e[i].GpsDateTime,oEndPos:e[i].Poi.MapPoint,cEndAddr:e[i].Poi.Address,nIndex:n})}r=null}var o=e.length,s=ES.Util.toDate(e[o-1].GpsDateTime).getTime()-ES.Util.toDate(e[0].GpsDateTime).getTime(),l=ES.TrackHelper.getTrackDateMsg(s),c=e[o-1].Mileage-e[0].Mileage,h={nTime:l.nTime,dMileage:(c/1e3).toFixed(2),AverageSpeed:(3600*c/s).toFixed(2),TraceCount:o,StartTime:e[0].GpsDateTime,EndTime:e[o-1].GpsDateTime,cMsg:l.cMsg};this.initReportUI(h),this.initDataPark(a),this._oParent.fire(this._oParent.getEvenName("setParkData"),{DataStop:a})}},getDefaultData:function(){return{RetCode:0,RetMsg:"OK",StartTime:"",EndTime:"",Data:{RunTimeSec:0,Mileage:0,AverageSpeed:0,TraceCount:0,DataRange:[],DataStop:[]}}},InitUIHandler:function(t){if(t&&t.Data){for(var e=0;e<t.Data.DataStop.length;e++)t.Data.DataStop[e].nIndex=e;this._oParent.fire(this._oParent.getEvenName("setParkData"),t.Data),this.initDataPark(t.Data),this.initDataRange(t.Data),this.initReportUI(t)}}}),ES.TrackView.PanelBox.ParkPanel.include({clearPark:function(){r("#"+this.oOption.cParkDiv).empty()},initDataPark:function(t){var e=this;if(t&&!(t.length<=0)){for(var a=r("#"+this.oOption.cParkDiv).empty(),i=0;i<t.length;i++)ES.Util.initTag(a,this.getParkConfig(t[i])),r("div.parkRecord[cId='"+t[i].nIndex+"']").data("oItem",{oItem:t[i]});r(".parkRecord").bind("click",this,function(t){var a=r(this).data("oItem");e._oParent.fire(e._oParent.getEvenName("localParkMarker"),a),r(".parkRecord").removeClass("selected"),r(this).addClass("selected")})}},getParkConfig:function(t){var e=ES.Util.toDate(t.cEndDate).getTime()-ES.Util.toDate(t.cBeginDate).getTime(),a=ES.TrackHelper.getTrackDateMsg(e);return{div:{div:[{class:"travel-date",span:{html:t.cBeginDate},html:"停留记录"},{class:"TrackPanel-mRow TrackPanel-hoverRow parkRecord",cId:t.nIndex,span:[{class:"TrackPanel-icon stay"},{html:t.cBeginDate+" 至 "+t.cEndDate},{html:"  停留时长："},{class:"TrackPanel-emOrStrongWithoutWeight",html:a.nTime+a.cMsg+" "},{html:t.cEndAddr}]}]}}}}),ES.TrackView.PanelBox.ParkPanel.include({clearRun:function(){r("#"+this.oOption.cRunDiv).empty()},initDataRange:function(t){if(t&&t.DataRange&&!(t.DataRange.length<=0))for(var e=r("#"+this.oOption.cRunDiv).empty(),a=0;a<t.DataRange.length;a++)ES.Util.initTag(e,this.getRunConfig(t.DataRange[a].StartGps,t.DataRange[a].EndGps))},getRunConfig:function(t,e){var a=ES.TrackHelper.getTrackDateMsg(1e3*(e.GpsTime-t.GpsTime));return{div:{div:[{class:"travel-date",span:{html:t.GpsDateTime.replace("T"," ")},html:"行程记录"},{div:{class:"travel-item",div:[{class:"TrackPanel-mRow",i:{class:"glyphicon glyphicon-map-marker text-success"},span:[{html:t.GpsDateTime.replace("T"," ")},{html:"从:"},{html:t.PoiInfo}]},{class:"TrackPanel-mRow",i:{class:"glyphicon glyphicon-map-marker text-danger"},span:[{class:"js_endTime",html:e.GpsDateTime.replace("T"," ")},{html:"到:"},{html:e.PoiInfo}]},{table:{class:"travel-item-table",tbody:{tr:{td:[{html:"行驶里程"},{class:"text-right TrackPanel-emOrStrongWithoutWeight",cid:"total_travelPeriod",html:((e.Mileage-t.Mileage)/1e3).toFixed(2)},{html:"km"},{html:"行驶时耗"},{class:"text-right TrackPanel-emOrStrongWithoutWeight",cid:"total_travelPeriod",html:a.nTime},{html:a.cMsg}]}}}}]}}]}}}}),ES.TrackView.PanelBox.ParkPanel.include({_oItem:{total_travelPeriod:"nTime",total_mileage:"dMileage",total_avgSpeed:"AverageSpeed",total_points:"TraceCount",tdBeginDate:"StartTime",tdEndDate:"EndTime",travelPeriod_msg:"cMsg"},clearReport:function(){for(var t in this._oItem)r("#"+t).text("")},initReportUI:function(t){for(var e in this._oItem)r("#"+e).text(t[this._oItem[e]])}}),ES.TrackView.PanelBox.SpeedDoorWeightPanel=ES.TrackView.PanelBox.BasePanel.extend({aoTrack:[],oOption:{cDivDoor:"divDoorChart",cDivSpeedWeight:"divSpeedWeightChart"},initialize:function(t,e){ES.setOptions(this,e),this._oParent=t,this.initOn(),this.initEvent()},initEvent:function(){r("#divSpeedWeightChart").on("click",function(t){})},initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.initUI,this),this._oParent.on(this._oParent.getEvenName("noticeTimerPlay"),this.refreshUI,this),this._oParent.on(this._oParent.getEvenName("clearMap"),this.clearMap,this)},clearMap:function(){this.aoTrack||this.aoTrack.splice(0,this.aoTrack.length);var t={acTime:[],adSpeed:[],adWeight:[],adDoor:[]},e=this.getSpeedWeightChartOption(t);this.oChart&&this.oChart.setOption(e,!0)},initUI:function(t){this.aoTrack.splice(0,this.aoTrack.length),r.merge(this.aoTrack,t.aoPageTrack);var t=this.dataConvert(),a=this.getSpeedWeightChartOption(t);this.oChart=echarts.init(e.getElementById(this.oOption.cDivSpeedWeight)),this.oChart.setOption(a,!0)},refreshUI:function(t){r.merge(this.aoTrack,t.aoPageTrack);var t=this.dataConvert(),a=this.getSpeedWeightChartOption(t);this.oChart=echarts.init(e.getElementById(this.oOption.cDivSpeedWeight)),this.oChart.setOption(a,!0)},getSpeedWeightChartOption:function(t){return{tooltip:{trigger:"axis",formatter:function(t){if(t.length){var e=t[0].name+"<br/>";return e+=t[0].seriesName+"： "+t[0].value+" Km/h<br/> "}}},calculable:!0,dataZoom:{show:!0,realtime:!0,start:0,end:100,height:15},legend:{selected:{"速度":!0},data:["速度"]},smooth:!0,grid:{x:"12%",y:"20%",x2:"10%",y2:"20%"},xAxis:[{type:"category",boundaryGap:!1,data:0==t.acTime.length?["2015-01-01"]:t.acTime}],yAxis:[{name:"速度",type:"value",boundaryGap:!1,axisLabel:{formatter:"{value}"}}],series:[{name:"速度",type:"line",data:0==t.adSpeed.length?[0]:t.adSpeed,itemStyle:{normal:{color:"green",lineStyle:{color:"green"}}},stack:"速度",markPoint:{data:[{type:"max",name:"最大值",itemStyle:{normal:{color:"#b62d22"}}},{type:"min",name:"最小值",itemStyle:{normal:{color:"#3c924c"}}}]},itemStyle:{normal:{color:"#f60",lineStyle:{color:"#f60"}}}}]}},dataConvert:function(){if(!this.aoTrack||this.aoTrack.length<=0)return{acTime:[],adSpeed:[],adWeight:[],adDoor:[]};for(var t=[],e=[],a=[],i=[],r=0;r<this.aoTrack.length;r++)t.push(this.aoTrack[r].GpsDateTime),a.push(this.aoTrack[r].Speed);return{acTime:t,adSpeed:a,adWeight:i,adDoor:e}}}),ES.TrackView.PointLayer={},ES.TrackView.PointLayer.BaseMarker=a.MapLib.MapMaster.MapOpr.extend({oOption:{cPosName:"轨迹开始点"},initialize:function(t,e){a.MapLib.MapMaster.MapOpr.prototype.initialize.call(this,t,e),this._oParent=t,this.initOn(),this.initGroup()},initGroup:function(){this._oMarkerGroup=new a.featureGroup,this._oMarkerGroup.addTo(this._oMap)},initOn:function(){this._oParent.on(this._oParent.getEvenName("drawMarker"),this.drawMarker,this),this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.firstReqTrackBC,this),this._oParent.on(this._oParent.getEvenName("noticeTimerPlay"),this.firstReqTrackBC,this)},clearMap:function(){this._oMarkerGroup.clearLayers()},getHtml:function(t){var e=ES.extend({},t,{cPoiInfo:t.Poi.Address||""});return ES.Util.template('<div class="ex-maptip-ztc">   <div class="ex-content-info-box">       <ul class="ec-u-sm-12">           <li><span><b>{cPosName}</b></span></li>           <li><span>位置：{cPoiInfo} <span></li>           <li><span>时间：{cGpsDateTime} </span></li>       </ul>   </div></div>',e)},getIcon:function(){return a.divIcon({iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[-1,-32],className:"",html:'<div class="track-marker track-site-marker"></div>'})},drawMarker:function(t){if(t&&t.oGpsInfo){var e=this.findLayer(this._oMarkerGroup,t.oGpsInfo.PhoneNum);e?e.setLatLng([t.oGpsInfo.Lat,t.oGpsInfo.Lng]):(e=a.marker([t.oGpsInfo.Lat,t.oGpsInfo.Lng],{icon:this.getIcon()}),e.addTo(this._oMarkerGroup));var i={};ES.extend(i,{cPosName:this.oOption.cPosName,cGpsDateTime:t.oGpsInfo.GpsDateTime.replace("T"," "),dMileage:(parseInt(t.oGpsInfo.Mileage)/1e3).toFixed(2)}),e.bindPopup(this.getHtml(i))}}}),ES.TrackView.PointLayer.AlarmMarkerMgr=ES.TrackView.PointLayer.BaseMarker.extend({initOn:function(){this._oParent.on(this._oParent.getEvenName("setAlarmData"),this.setAlarmData,this),this._oParent.on("Track:Bar.dealAlarmMarkers",this.dealAlarmMarkers,this),this._oParent.on("Track:Bar.clearAlarmMarkers",this.clearMarkers,this),this._oParent.on(this._oParent.getEvenName("localAlarmMarker"),this.localAlarmMarker,this),this._oParent.on(this._oParent.getEvenName("clearMap"),this.clearMap,this)},localAlarmMarker:function(t){if(t){var e=t.oItem;if(e){this.drawMarker(e);var i=a.latLng(e.AlarmPoi.MapPoint.Lat,e.AlarmPoi.MapPoint.Lon);this.flyTo(i)}}},setAlarmData:function(t){this.aoData=t.aoAlarm},dealAlarmMarkers:function(t){t&&(t.bIsDraw?this.drawMarkers():this.clearMarkers())},drawMarkers:function(){if(this.aoData&&!(this.aoData.length<=0))for(var t=0;t<this.aoData.length;t++)this.drawMarker(this.aoData[t])},clearMarkers:function(){this._oMarkerGroup&&this._oMarkerGroup.clearLayers()},drawMarker:function(t){var e=this.findLayer(this._oMarkerGroup,t.nIndex);e?(e.setLatLng([t.AlarmPoi.MapPoint.Lat,t.AlarmPoi.MapPoint.Lon]),e.openPopup()):(e=a.marker([t.AlarmPoi.MapPoint.Lat,t.AlarmPoi.MapPoint.Lon],{icon:this.getIcon(t)}),e.cId=t.nIndex,e.addTo(this._oMarkerGroup),e.bindPopup(this.getHtml(t)))},getIcon:function(t){var e={iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[-1,-32],className:"",html:'<div class="track-marker track-alarm-marker"></div>'},i=t.AlarmType,r=this.getAlarmTypeName(i);if(r){var n="<div class='track-marker track-alarm-marker'><div class= 'car-state "+r+"' ></div></div>";e=ES.extend(e,{html:n})}return a.divIcon(e)},getAlarmTypeName:function(t){var e=this.getAlarmType();if(e)return e[t]},getAlarmType:function(){return{100:"cover",105:"o-earth",210:"work",104:"i-earth",106:"speed"}},getHtml:function(t){var e=ES.TrackHelper.getTrackDateMsg(60*t.ContinueTime*1e3);return'<div class="ex-maptip-ztc">   <div class="ex-content-info-box">       <ul class="ec-u-sm-12">           <li><span>次数：'+t.AlarmCount+" </span></li>           <li><span>时长："+e.nTime+" "+e.cMsg+"  <span></li>           <li><span>类型："+ES.TrackHelper.getAlarmTypeName(t.AlarmType)+" </span></li>           <li><span>位置："+t.AlarmPoi.Address+" </span></li>           <li><span>时间："+ES.Util.dateFormat(1e3*t.AlarmTime,"yyyy-MM-dd hh:mm:ss")+" </span></li>       </ul>   </div></div>"}}),ES.TrackView.PointLayer.BeginMarker=ES.TrackView.PointLayer.BaseMarker.extend({initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.drawMarker,this),this._oParent.on(this._oParent.getEvenName("clearMap"),this.clearMap,this)},drawMarker:function(t){if(t&&t.aoTrack&&!(t.aoTrack.length<=0)){var e=t.aoTrack[0],i=this.findLayer(this._oMarkerGroup,e.PhoneNum);i?i.setLatLng([e.Lat,e.Lng]):(i=a.marker([e.Lat,e.Lng],{icon:this.getIcon()}),i.addTo(this._oMarkerGroup));var r={};ES.extend(r,e,{cPosName:this.oOption.cPosName,cGpsDateTime:e.GpsDateTime.replace("T"," "),dMileage:(parseInt(e.Mileage)/1e3).toFixed(2)}),i.bindPopup(this.getHtml(r))}},getIcon:function(){return a.divIcon({iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[-1,-32],className:"",html:'<div class="track-marker track-begin-marker"></div>'})}}),ES.TrackView.PointLayer.EndMarker=ES.TrackView.PointLayer.BaseMarker.extend({initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.drawMarker,this),this._oParent.on(this._oParent.getEvenName("noticeTimerPlay"),this.drawMarker,this),this._oParent.on(this._oParent.getEvenName("clearMap"),this.clearMap,this)},drawMarker:function(t){if(t&&t.aoTrack&&!(t.aoTrack.length<=0)&&!(t.nPage<t.nTotalPage)){var e=t.aoPageTrack[t.aoPageTrack.length-1];if(e){var i=this.findLayer(this._oMarkerGroup,e.PhoneNum);i?i.setLatLng([e.Lat,e.Lng]):(i=a.marker([e.Lat,e.Lng],{icon:this.getIcon()}),i.addTo(this._oMarkerGroup));var r={};ES.extend(r,e,{cPosName:this.options.cPosName,cGpsDateTime:e.GpsDateTime.replace("T"," "),dMileage:(parseInt(e.Mileage)/1e3).toFixed(2)}),i.bindPopup(this.getHtml(r))}}},getIcon:function(){return a.divIcon({iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[-1,-32],className:"",html:'<div class="track-marker track-end-marker"></div>'})}}),ES.TrackView.PointLayer.ParkMarkerMgr=ES.TrackView.PointLayer.BaseMarker.extend({initOn:function(){this._oParent.on(this._oParent.getEvenName("setParkData"),this.setParkData,this),this._oParent.on("Track:Bar.dealParkMarkers",this.dealParkMarkers,this),this._oParent.on("Track:Bar.clearParkMarkers",this.clearMarkers,this),this._oParent.on(this._oParent.getEvenName("localParkMarker"),this.localParkMarker,this),this._oParent.on(this._oParent.getEvenName("clearMap"),this.clearMap,this)},getIcon:function(){return a.divIcon({iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[-1,-32],className:"",html:'<div class="track-marker track-park-marker"></div>'})},localParkMarker:function(t){if(t&&t.oItem){var e=t.oItem;this.drawMarker(e);var i=a.latLng(e.oEndPos.Lat,e.oEndPos.Lon);this.flyTo(i)}},setParkData:function(t){this.aoData=t.DataStop},dealParkMarkers:function(t){t&&(t.bIsDraw?this.drawMarkers():this.clearMarkers())},drawMarkers:function(){if(this.aoData&&!(this.aoData.length<=0))for(var t=0;t<this.aoData.length;t++)this.drawMarker(this.aoData[t])},clearMarkers:function(){this._oMarkerGroup&&this._oMarkerGroup.clearLayers()},drawMarker:function(t){var e=this.findLayer(this._oMarkerGroup,t.nIndex);e?(e.setLatLng([t.oEndPos.Lat,t.oEndPos.Lon]),e.openPopup()):(e=a.marker([t.oEndPos.Lat,t.oEndPos.Lon],{icon:this.getIcon()}),e.cId=t.nIndex,e.addTo(this._oMarkerGroup),e.bindPopup(this.getHtml(t)))},getHtml:function(t){var e=ES.Util.toDate(t.cEndDate).getTime()-ES.Util.toDate(t.cBeginDate).getTime(),a=ES.TrackHelper.getTrackDateMsg(e),i=a.nTime+" "+a.cMsg,r=t.cBeginDate+" 到 "+t.cEndDate;return'<div class="ex-maptip-ztc">   <div class="ex-content-info-box ">       <ul class="ec-u-sm-12">           <li><span><b>停车点</b></span></li>           <li><span>停车时长：'+i+" <span></li>           <li><span>停车位置："+t.cEndAddr+" </span></li>           <li><span>停车时间："+r+" </span></li>       </ul>   </div></div>"}}),ES.TrackView.PointLayer.SubMarkerMgr=ES.TrackView.PointLayer.BaseMarker.extend({initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.drawMarker,this),this._oParent.on(this._oParent.getEvenName("noticeTimerPlay"),this.drawMarker,this),this._oParent.on(this._oParent.getEvenName("clearMap"),this.clearMap,this)},getIcon:function(t){return a.divIcon({iconSize:[32,32],iconAnchor:[16,32],popupAnchor:[-1,-32],className:"",html:'<div class="track-marker track-page-marker"><div>'+t.nPage+"</div></div>"})},drawMarker:function(t){if(t&&t.aoTrack&&!(t.aoTrack.length<=0)&&t.nPage!==t.nTotalPage){var e=t.aoPageTrack[t.aoPageTrack.length-1];if(e){var i=this.findLayer(this._oMarkerGroup,t.nPage);i?i.setLatLng([e.Lat,e.Lng]):(i=a.marker([e.Lat,e.Lng],{icon:this.getIcon(t)}),i.addTo(this._oMarkerGroup));var r={};ES.extend(r,e,{cPosName:this.oOption.cPosName,cGpsDateTime:e.GpsDateTime.replace("T"," "),dMileage:(parseInt(e.Mileage)/1e3).toFixed(2)}),i.bindPopup(this.getHtml(r))}}}}),ES.TrackView.RealTrack={},ES.TrackView.RealTrack.BaseRealTrack=a.MapLib.MapMaster.MapOpr.extend({initialize:function(t,e){a.MapLib.MapMaster.MapOpr.prototype.initialize.call(this,t,e),this._oParent=t,this._oParent.on(this._oParent.getEvenName("clearMap"),this.clearMap,this)},getLight:function(t){var e={cClsLight:"gray",cClsDoor:"red",cClsWeight:"yellow"};return 1===t.nGreenOn?(t.cLight="绿灯",void(e.cClsLight="green")):1===t.nRedOn?(t.cLight="红灯",void(e.cClsLight="red")):1===t.nYelloOn?(t.cLight="黄灯",void(e.cClsLight="yellow")):(t.cLight="白灯",e.cClsLight="gray",e)},getVecMarkerHtmlNotBtn:function(t){var e=this.getLight(t),a={};return ES.extend(a,t,{cDir:ES.TrackHelper.getDire(parseInt(t.Direction)),cGpsDateTime:t.GpsDateTime.replace("T"," "),dMileage:(parseFloat(t.Mileage)/1e3).toFixed(2),cPoiInfo:t.Poi.Address||""},e),ES.Util.template('<div class="ex-maptip-ztc">   <div class="ex-content-info-box">       <ul class="ec-u-sm-12">           <li><span>车牌号：{VehicleNo}</span></li>           <li><span>企业：{CompanyName}</span></li>           <li><span>速度：{Speed} Km/h <span></li>           <li><span>方向：{cDir} </span></li>           <li><span>位置：{cPoiInfo} </span></li>           <li><span>时间：{cGpsDateTime} </span></li>       </ul>   </div></div>',a)},_getPosIconInfo:function(t,e){var i='<div cid="{PhoneNum}"  class="car-body"    style="transform:rotate({nDir}deg);-webkit-transform: rotate({nDir}deg);"></div>    <div class="pin-tip " style="display: none;">           <div class="pin-dome"><b></b><c></c><d></d></div>           <div class="pin-number">{VehicleNo}</div>           <div class="pin-state"> </div></div>';return t.nDir=parseInt(t.direction)+180,i=ES.template(i,t),new a.DivIcon({html:i,className:"ex-monitor-mapicon-truck green",iconSize:a.point(e.nSize,e.nSize),iconAnchor:a.point(16,16),popupAnchor:a.point(-0,-20)})},_setHeading:function(t,e){if(t){e||(e=0);var a=parseInt(t.Direction)+e;r("div[cId='"+t.PhoneNum+"']").attr("style","transform: rotate("+a+"deg);-webkit-transform: rotate("+a+"deg);")}},initGroup:function(){this._oLayerGroup=new a.featureGroup,this._oLayerGroup.addTo(this._oMap)},clearMap:function(){this._oLayerGroup&&this._oLayerGroup.clearLayers()}}),ES.TrackView.RealTrack.TrackPos=ES.TrackView.RealTrack.BaseRealTrack.extend({initialize:function(t,e){ES.TrackView.RealTrack.BaseRealTrack.prototype.initialize.call(this,t,e),this._oParent=t,this.oTimes=new ES.MonitorTimer(this,{nIntervalSpeed:100,bIsStart:!1}),this.aoParkInfo=new Array,this._nCursor=0,this.initOn(),this.nSpeed=100,this.initGroup()},initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.initPos,this),this._oParent.on("Track:moveSliderCursor",this.moveCursor,this),this._oParent.on(this._oParent.getEvenName("play"),this.play,this),this._oParent.on(this._oParent.getEvenName("noticeTimerPlay"),this.noticeTimerPlay,this),this._oParent.on(this._oParent.getEvenName("setPlaySpeed"),this.setPlaySpeed,this),this._oParent.on(this._oParent.getEvenName("pause"),this.stop,this),this._oParent.on(this._oParent.getEvenName("playFinish"),this.stop,this)},setPopupOpen:function(){},getPopupOpen:function(){var t=this._oParent.getCkbStatus();return!!t&&t.bIsPopup},play:function(){this.oTimes.on({oContext:this,fnCallBack:this.playing}),this.oTimes.start()},stop:function(){this.oTimes&&this.oTimes.stop()},setPlaySpeed:function(t){this.oTimes.setSpeed(t.nSpeed),this.nSpeed=t.nSpeed,"inline-block"==r(".track-play").css("display")&&this.oTimes.stop()},playing:function(){if(this._nCursor>=this.aoGpsInfo.length)this.oTimes.stop(),this._oParent.fire("Track:setSliderCursor",{nIndex:100}),ES.aWarn("轨迹播放完成！"),this._oParent.fire(this._oParent.getEvenName("playFinish"));else{this.drawVecPos(this._nCursor);var t=parseInt(100*this._nCursor/this.aoGpsInfo.length);this._oParent.fire("Track:setSliderCursor",{nIndex:t}),this._nCursor=this._nCursor+1}},initPos:function(t){this._nCursor=0,this.stop(),this.aoGpsInfo=t.aoPageTrack,this.aoGpsInfo.length<=0||this.drawVecPos(this._nCursor)},moveCursor:function(t){if(this.aoGpsInfo&&!(this.aoGpsInfo.length<=0)){this.oTimes.getStatus()?this._nCursor=parseInt(this.aoGpsInfo.length*t.nIndex/100):(this._nCursor=parseInt(this.aoGpsInfo.length*t.nIndex/100),this.drawVecPos(this._nCursor))}},noticeTimerPlay:function(t){this.aoGpsInfo=t.aoPageTrack,this._nCursor=0,!this.aoGpsInfo||this.aoGpsInfo.length<=0?(this.oTimes.stop(),ES.aWarn("轨迹播放完成！"),this._oParent.fire(this._oParent.getEvenName("playFinish"))):"none"!==r(".track-play").css("display")?this.oTimes.stop():this.oTimes.start()},drawVecPos:function(t){var e=this.aoGpsInfo[t];if(!e);var i=a.latLng(e.Lat,e.Lng);this.posInSrceen(i)||this._oMap.panTo(i),this._oParent.fire("ES.MapOpr.TrackView.TrackPos:drawVecPos",{oGpsInfo:e}),this._drawVecPos(t)},_drawVecPos:function(t){if(this._oLayerGroup){var e=this.aoGpsInfo[t],i=a.latLng(e.Lat,e.Lng),r=this.findLayer(this._oLayerGroup,e.PhoneNum);if(!r){var n=a.Marker.movingMarker([i],100,{icon:this._getPosIconInfo(e,{nSize:32})});n.cId=e.PhoneNum,n.cVehNo=e.VehicleNo,n.oData=e,n.addTo(this._oLayerGroup),this._setHeading(e,180);var o=this.getVecMarkerHtmlNotBtn(e);return this.getPopupOpen()?n.bindPopup(o,{autoPan:!1}).openPopup():n.bindPopup(o,{autoPan:!1}),n}r.moveTo(i,this.nSpeed),this._setHeading(e,180);var o=this.getVecMarkerHtmlNotBtn(e);return r.setPopupContent(o),this.getPopupOpen()?r.openPopup():r.closePopup(),r._bringToFront(),r}}}),ES.TrackView.RealTrack.TrackArrow=ES.TrackView.RealTrack.BaseRealTrack.extend({oOption:{nLenPx:20},initialize:function(t,e){ES.TrackView.RealTrack.BaseRealTrack.prototype.initialize.call(this,t,e),this._oParent=t,this.initOn(),this.initGroup(),this._reDrawArrow()},initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.firstReqTrackBC,this),this._oParent.on(this._oParent.getEvenName("noticeTimerPlay"),this.setTrackClass,this),this._oParent.on(this._oParent.getEvenName("setTrackClass"),this.setTrackClass,this)},firstReqTrackBC:function(t){!t||!t.aoTrack||t.aoTrack.length<=0||this._oLayerGroup&&(this.oTrackData=t,this.clearMap(),this._drawArrow(this.oTrackData),this.setTrackClass())},setTrackClass:function(){var t=this._oParent.getCkbStatus()
;t&&(t.bIsTrackLine?this._drawArrow(this.oTrackData):this.clearMap())},_drawArrow:function(t){if(t&&t.aoTrack&&!(t.aoTrack.length<=0)){this.aoTrack=t.aoTrack;for(var e=t.aoTrack[0].PhoneNum,i=(this.findLayer(this._oLineGroup,e),t.aoTrack.map(function(t){return a.latLng(t.Lat,t.Lng)})),r=this._oMap.getZoom(),n=0,o=!1,s=0;s<i.length&&s!=i.length-1;s++){var l=this._oMap.project(i[s],r),c=this._oMap.project(i[s+1],r),n=n+l.distanceTo(c),h=l.distanceTo(c);if(o){if(h<2)continue;o=!1;var d=a.latLng({lat:((i[s].lat+i[s+1].lat)/2).toFixed(6),lng:((i[s].lng+i[s+1].lng)/2).toFixed(6)}),p=[i[s],d],u={};ES.extend(u,ES.TrackView.Config.oLiveLineConfig,{bEndArrow:!0,weight:2});var m=a.polyline(p,u);m.addTo(this._oLayerGroup),m.bringToFront(),n=0}else n>this.oOption.nLenPx&&(o=!0)}this._oParent.fire(this._oParent.getEvenName("setToFront"))}},_reDrawArrow:function(){var t=this;this._oMap.on("moveend",function(e){t.aoTrack&&t._oLayerGroup&&(t._oLayerGroup.clearLayers(),t._drawArrow({aoTrack:t.aoTrack}),r("path[d='M0 0'][marker-end='url(#arrow)']").remove(),t.setTrackClass(),t._oParent.fire("ES.MapOpr.TrackView.TrackArrow: moveend"),t._oParent.fire(this._oParent.getEvenName("setToFront")))},this)}}),ES.TrackView.RealTrack.TrackLine=ES.TrackView.RealTrack.BaseRealTrack.extend({includes:ES.Mixin.Events,oEvenName:{drawMarker:"Track:BeginEndMarker.drawMarker"},initialize:function(t,e){ES.TrackView.RealTrack.BaseRealTrack.prototype.initialize.call(this,t,e),this._oParent=t,this.aoParkInfo=new Array,this.initOn(),this.initGroup()},initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.firstReqTrackBC,this),this._oParent.on(this._oParent.getEvenName("noticeTimerPlay"),this.noticeTimerPlay,this),this._oParent.on(this._oParent.getEvenName("setTrackClass"),this.setTrackClass,this)},firstReqTrackBC:function(t){this.noticeTimerPlay(t);var e=this._oLayerGroup.getBounds();e&&e.hasOwnProperty("_northEast")&&this._oMap.fitBounds(e)},noticeTimerPlay:function(t){this.drawTrack(t),this.setTrackClass(t)},drawTrack:function(t){if(!t||!t.aoTrack||t.aoTrack.length<=0)return void(this.aoLatLng=[]);this.PhoneNum=t.aoTrack[0].PhoneNum,this.aoLatLng=t.aoTrack.map(function(t){return[t.Lat,t.Lng]})},setTrackClass:function(){var t=this._oParent.getCkbStatus();if(t)if(t.bIsTrackLine){var e=this.findLayer(this._oLayerGroup,this.PhoneNum);e?e.setLatLngs(this.aoLatLng):(e=a.polyline(this.aoLatLng,ES.TrackView.Config.oLiveLineConfig),e.addTo(this._oLayerGroup))}else this.clearMap()},drawLine:function(t){var e=this.findLayer(this._oLayerGroup,oPosInfo.cDevId);return e?(e.setLatLngs(oPosInfo.aoLatLng),this._drawArrow(e.getLatLngs())):(e=a.polyline(oPosInfo.aoLatLng,ES.TrackView.Config.oLiveLineConfig),e.addTo(this._oLayerGroup),this._drawArrow(oPosInfo.aoLatLng),this.clearNullArrow(oPosInfo.cDevId)),e}}),ES.TrackView.RealTrack.TrackMarker=ES.TrackView.RealTrack.BaseRealTrack.extend({initialize:function(t,e){ES.TrackView.RealTrack.BaseRealTrack.prototype.initialize.call(this,t,e),this._oParent=t,this.aoParkInfo=new Array,this.initOn(),this.initGroup()},initOn:function(){this._oParent.on(this._oParent.getEvenName("firstReqTrackBC"),this.firstReqTrackBC,this),this._oParent.on(this._oParent.getEvenName("noticeTimerPlay"),this.firstReqTrackBC,this),this._oParent.on(this._oParent.getEvenName("setPosClass"),this.setPosClass,this),this._oParent.on(this._oParent.getEvenName("setToFront"),this.setToFront,this)},setToFront:function(){this._oLayerGroup.bringToFront()},firstReqTrackBC:function(t){!t||!t.aoTrack||t.aoTrack.length<=0||(this.aoTrack=t.aoTrack,this.setPosClass())},setPosClass:function(){var t=this._oParent.getCkbStatus();if(t)if(t.bIsTrackPos){var e=this;r.each(this.aoTrack,function(t,i){var r=a.circleMarker([i.Lat,i.Lng],ES.TrackView.Config.oTrackPosConfig),n=e.getVecMarkerHtmlNotBtn(i);r.bindPopup(n),r.addTo(e._oLayerGroup)})}else this.clearMap()}}),ES.VehTrackInfo=ES.Class.extend({}),ES.VehTrackInfo.RealStatus=ES.VehTrackInfo.extend({includes:ES.Mixin.Events,oOption:{cTagGpsInfo:".ec-g > .ec-u-md-4 > .stats-card > ul.ec-avg-md-2",cTagVehStatusInfo:".ec-g > .ec-u-md-4 > .stats-card > ul.ex-acc",cTagMobileInfo:".ex-layout-mobile",cSpeedChartId:"echartsSpeed",cSpeed:""},initialize:function(t,e){ES.setOptions(this,e),this._oParent=t,this.$_oContent=r(".ex-layout-maptool.ex-theme-maptool.ex-map-bottom.ex-map-right"),this.$_oContent.css("visibility","hidden"),this.initOn()},initOn:function(){this._oParent.on("ES.MapOpr.TrackView.TrackPos:drawVecPos",this.callBack,this)},callBack:function(t){this.$_oContent.css("visibility","visible"),this.setVehLight(t.oGpsInfo),this.setMobileInfo(t.oGpsInfo),this.setVehStatusInfo(t.oGpsInfo)},setVehLight:function(t){if(t){r(".car-light").removeClass("l-green").removeClass("l-red").removeClass("l-yellow").removeClass("l-gray"),r('a[cId="cz"]').removeClass("green").removeClass("warning").removeClass("yellow");var e="l-gray";"True"===t.Property.ZtLeightGreenOn?(e="l-green",r('a[cId="cz"]').addClass("green")):"True"===t.Property.ZtLeightRedOn?(e="l-red",r('a[cId="cz"]').addClass("warning")):"True"===t.Property.ZtLeightYelloOn&&(e="l-yellow",r('a[cId="cz"]').addClass("yellow")),r(".car-light").addClass(e)}},setVehStatusInfo:function(t){t.Status&&(r(this.oOption.cTagVehStatusInfo).parent().show(),t.FrontDoor?r(".car-cover").animate({left:"-360px"},500):r(".car-cover").animate({left:"0px"},500),t.FrontDoor?r(".car-cover").css("left","-360px"):r(".car-cover").css("left","0px"))},setMobileInfo:function(t){var e=r(".ex-icon-mobile"),a=r(".ex-icon-bd");e.removeClass("on").removeClass("off"),a.removeClass("on").removeClass("off"),e.addClass("on"),a.addClass("on")}}),ES.VehTrackInfo.SpeedChart=ES.VehTrackInfo.extend({oOption:{cDivContain:"echartsSpeed",nAvgSpeed:60,nMaxSpeed:100},initialize:function(t,e){ES.setOptions(this,e),this._oParent=t,this.oChart=null,this.oChartOption=null,this.initChart(),this.initOn()},initChart:function(){this.oChart=echarts.init(e.getElementById(this.oOption.cDivContain)),this._setChartConfig()},initOn:function(){this._oParent.on("ES.MapOpr.TrackView.TrackPos:drawVecPos",this.callBack,this)},callBack:function(t){this.changeSpeed(t.oGpsInfo)},_setChartConfig:function(t){var e=this.oOption.nAvgSpeed/this.oOption.nMaxSpeed;this.oChartOption={backgroundColor:"#b68500",tooltip:{formatter:"{a} <br/>{c}km/h"},grid:{top:0,left:0,right:0,bottom:0},series:[{name:"速度",type:"gauge",radius:"100%",min:0,max:this.oOption.nMaxSpeed,splitNumber:11,axisLine:{lineStyle:{width:10,color:[[e,"#e2f4e0"],[1,"#ffc09d"]]}},axisTick:{length:15,lineStyle:{color:"auto"}},splitLine:{length:20,lineStyle:{color:"auto"}},axisLabel:{show:!1},title:{show:!1},detail:{formatter:"速度\n{value}km/h",offsetCenter:[0,"45%"],textStyle:{color:"#fff",fontSize:16,fontWeight:"bold"}},data:[{value:80,name:"速度"}]}]},this.oChartOption={backgroundColor:"#136635",tooltip:{formatter:"{a} <br/>{c}km/h"},grid:{top:0,left:0,right:0,bottom:0},series:[{name:"速度",type:"gauge",radius:"90%",min:0,max:this.oOption.nMaxSpeed,splitNumber:5,axisLine:{lineStyle:{width:3,color:[[e,"#72d572"],[1,"#f4511e"]]}},axisTick:{length:6,lineStyle:{color:"auto"}},splitLine:{length:9,lineStyle:{color:"auto"}},axisLabel:{show:!1},title:{show:!1},detail:{formatter:"速度\n{value}km/h",offsetCenter:[0,"45%"],textStyle:{color:"#fff",fontSize:12,fontWeight:"bold"}},data:[{value:0,name:"速度"}]}]},this.oChart.setOption(this.oChartOption,!0)},changeSpeed:function(t){this.oChartOption.series[0].data[0].value=t.Speed,this.oChart.setOption(this.oChartOption,!0)},clearChart:function(){this.oChart&&this.oChart.clear()}}),ES.VehTrackInfo.WeightChart=ES.VehTrackInfo.extend({oOption:{cDivContain:"echartsWeight",nAvgSpeed:60,nMaxSpeed:100},initialize:function(t,e){ES.setOptions(this,e),this._oParent=t,this.initUI(),this.initOn()},initUI:function(){this.oChart=echarts.init(e.getElementById(this.oOption.cDivContain)),this._setChartConfig()},initOn:function(){this._oParent.on("ES.MapOpr.TrackView.TrackPos:drawVecPos",this.callBack,this)},callBack:function(t){this.changeWeight(t.oGpsInfo)},_setChartConfig:function(t){this.oOption.nAvgSpeed,this.oOption.nMaxSpeed;this.oChartOption={backgroundColor:"#136635",tooltip:{formatter:"{a} <br/>{c}"},grid:{top:0,left:0,right:0,bottom:0},series:[{name:"载重",type:"gauge",radius:"90%",min:0,max:30,splitNumber:5,axisLine:{lineStyle:{width:5,color:[[.1,"#fff"],[.6,"#00ff00"],[.8,"#f5c01b"],[1,"#b62d22"]]}},axisTick:{length:6,lineStyle:{color:"auto"}},splitLine:{length:9,lineStyle:{color:"auto"}},axisLabel:{show:!1},title:{show:!1},detail:{formatter:"载重\n{value}",offsetCenter:[0,"45%"],textStyle:{color:"#fff",fontSize:20,fontWeight:"bold"}},data:[{value:0,name:"速度"}]}]},this.oChart.setOption(this.oChartOption,!0)},changeWeight:function(t){if(t){var e=100,a=parseInt(t.sWeightValue)||0;e="True"===t.Property.ZtLeightGreenOn?100*a/50:"True"===t.Property.ZtLeightRedOn?100*a/90:"True"===t.Property.ZtLeightYelloOn?100*a/70:100*a/5,this.oChartOption.series[0].max=e||100,this.oChartOption.series[0].data[0].value=parseInt(t.sWeightValue),this.oChart.setOption(this.oChartOption,!0)}}}),ES.TrackView.SiteLayer=a.MapLib.MapMaster.MapOpr.extend({oOption:{oStyleConfig:{stroke:!0,color:"green",dashArray:null,lineCap:null,lineJoin:null,weight:2,opacity:.6,fill:!0,fillColor:"green",fillOpacity:.1,clickable:!1,smoothFactor:1,noClip:!1},oStyleSmallConfig:{stroke:!0,color:"green",dashArray:null,lineCap:null,lineJoin:null,weight:2,opacity:1,fill:!1,fillColor:null,fillOpacity:.2,clickable:!1,smoothFactor:1,noClip:!1}},_getLineColor:function(t,e){return{color:"green"}},initialize:function(t,e){a.MapLib.MapMaster.MapOpr.prototype.initialize.call(this,t,{}),ES.setOptions(this,e),this._initGroup(),this._loadOn()},_initGroup:function(){this._oPolylineGroup=a.featureGroup(),this._oMap.addLayer(this._oPolylineGroup)},_loadOn:function(){this._oParent.on("TrackView.SiteLayer:DrawArea",this.drawLayers,this),this._oParent.on("TrackView.SiteLayer:ClearArea",this.clearLayer,this),this._oParent.on("TrackView.SiteLayer:RemoveArea",this.removeLayers,this)},removeLayers:function(t){for(var e=t.aoData,a=0;a<e.length;a++){var i=this.findLayer(this._oPolylineGroup,e[a].Id);i&&(i.oMarker&&this._oPolylineGroup.removeLayer(i.oMarker),this._oPolylineGroup.removeLayer(i))}},clearLayer:function(){this._oPolylineGroup.clearLayers()},drawLayers:function(t){if(t&&t.aoData)for(var e=0;e<t.aoData.length;e++){var a=this.findLayer(this._oPolylineGroup,t.aoData[e].Id);a||this.drawLayer(t.aoData[e],t.cTarget)}},drawLayer:function(t,e){if(t){var a=this.createLayer(t,e);a&&(a.cId=t.Id,a.bindTooltip(t.Name))}},_getIcon:function(t){return a.divIcon({iconSize:[0,0],iconAnchor:[15,20],popupAnchor:[-1,-20],className:"ex-monitor-mapicon-truck",html:t})},initEventForMarker:function(t){t&&t.on("click",function(){ES.Util.reqData({url:"/AssessSegment/GetMapPopup",data:{Mseg:this.SegmentCode},dataType:"html"},function(t){this.bindPopup(t.rtnData,{maxWidth:400}),this.openPopup()},this)},t)},createLayer:function(t,e){var i=this.findLayer(this._oPolylineGroup,t.Id);if(i)return i;if(!t||!t.MapY)return i;for(var r=[],n=t.MapY.split(","),o=t.MapX.split(","),s=0;s<n.length;s++)r.push({lat:n[s],lng:o[s]});return i=a.polygon(r,this.oOption.oStyleConfig).addTo(this._oPolylineGroup)}}),ES.TrackView.SiteLayer.include({cHtml:'<div class="car-body"></div><div class="pin-tip" style="display: block;">     <div class="areaCount-number"            style="height: 22px;           position: absolute;           left: 13px;bottom: -25px;           z-index: 17;background-color: #447e2a;color: #fff;           border: 2px solid #fff;white-space: nowrap;           box-shadow: 0 0 3px rgba(0,0,0,.55);           padding: 0 10px 0 20px;border-radius: 0 2rem 2rem 0;">{Name}   </div></div>'}),ES.TrackView.UnloadLayer=ES.TrackView.SiteLayer.extend({oOption:{oStyleConfig:{stroke:!0,color:"red",dashArray:null,lineCap:null,lineJoin:null,weight:2,opacity:.6,fill:!0,fillColor:"red",fillOpacity:.1,clickable:!1,smoothFactor:1,noClip:!1},oStyleSmallConfig:{stroke:!0,color:"red",dashArray:null,lineCap:null,lineJoin:null,weight:2,opacity:1,fill:!1,fillColor:null,fillOpacity:.2,clickable:!1,smoothFactor:1,noClip:!1}},_loadOn:function(){this._oParent.on("TrackView.UnloadLayer:DrawArea",this.drawLayers,this),this._oParent.on("TrackView.UnloadLayer:ClearArea",this.clearLayer,this),this._oParent.on("TrackView.UnloadLayer:RemoveArea",this.removeLayers,this)}}),ES.TrackView.SusSiteLayer=ES.TrackView.SiteLayer.extend({oOption:{oStyleConfig:{stroke:!0,color:"orange",dashArray:null,lineCap:null,lineJoin:null,weight:2,opacity:1,fill:!0,fillColor:"orange",fillOpacity:.1,clickable:!1,smoothFactor:1,noClip:!1},oStyleSmallConfig:{stroke:!0,color:"orange",dashArray:null,lineCap:null,lineJoin:null,weight:2,opacity:1,fill:!1,fillColor:null,fillOpacity:.2,clickable:!1,smoothFactor:1,noClip:!1}},_loadOn:function(){this._oParent.on("TrackView.SusSiteLayer:DrawArea",this.drawLayers,this),this._oParent.on("TrackView.SusSiteLayer:ClearArea",this.clearLayer,this)},drawLayers:function(t){this._oPolylineGroup.clearLayers();var e=this._oParent.getLatLngs();if(e){var i=a.polygon(e,this.oOption.oStyleConfig).addTo(this._oPolylineGroup),r=ES.Util.template(this.cHtml,{Name:"可疑工地"}),n=this._getIcon(r),o=a.marker(i.getCenter(),{icon:n});o.addTo(this._oPolylineGroup),i.oMarker=o;var s=this._oPolylineGroup.getBounds();s.isValid()&&this._oMap.fitBounds(s)}},drawSusSite:function(){if(""!==m_cLatLng&&m_cLatLng){var t=m_cLatLng.split(",");if(t&&2==t.length){var e=a.latLng(t[1],t[0]);this.drawLayers({oLatLng:e})}}}}),ES.TrackView.WorkSiteLayer=ES.TrackView.SiteLayer.extend({initialize:function(t,e){ES.TrackView.SiteLayer.prototype.initialize.call(this,t,{}),this.initUI()},initUI:function(){var t=this._oParent.getSiteId();t&&ES.Util.reqData({data:{anId:[-t]},url:"/Site/GetSiteByIds"},function(t){this.drawLayer(t)},this)},_loadOn:function(){},drawLayer:function(t,e){if(t&&t.rtnData&&!(t.rtnData.length<=0)){var i=t.rtnData[0],r=this.createLayer(i,e);if(r){r.cId=i.Id;var n=ES.Util.template(this.cHtml,i),o=this._getIcon(n),s=a.marker(r.getCenter(),{icon:o});s.addTo(this._oPolylineGroup),r.oMarker=s}}},createLayer:function(t,e){var i=this.findLayer(this._oPolylineGroup,t.Id);return i||(t&&t.Points?i=a.polygon(t.Points,this.oOption.oStyleConfig).addTo(this._oPolylineGroup):i)}}),ES.TrackView.SusUnloadLayer=ES.TrackView.SiteLayer.extend({oOption:{oStyleConfig:{stroke:!0,color:"orange",dashArray:null,lineCap:null,lineJoin:null,weight:2,opacity:1,fill:!0,fillColor:"orange",fillOpacity:.1,clickable:!1,smoothFactor:1,noClip:!1},oStyleSmallConfig:{stroke:!0,color:"orange",dashArray:null,lineCap:null,lineJoin:null,weight:2,opacity:1,fill:!1,fillColor:null,fillOpacity:.2,clickable:!1,smoothFactor:1,noClip:!1}},_loadOn:function(){this._oParent.on("TrackView.SusUnloadLayer:DrawArea",this.drawLayers,this),this._oParent.on("TrackView.SusUnloadLayer:ClearArea",this.clearLayer,this)},drawLayers:function(t){this._oPolylineGroup.clearLayers();var e=this._oParent.getSusUnloadLatLngs();if(e){var i=a.polygon(e,this.oOption.oStyleConfig).addTo(this._oPolylineGroup),r=ES.Util.template(this.cHtml,{Name:"可疑消纳"}),n=this._getIcon(r),o=a.marker(i.getCenter(),{icon:n});o.addTo(this._oPolylineGroup),i.oMarker=o;var s=this._oPolylineGroup.getBounds();s.isValid()&&this._oMap.fitBounds(s)}},drawSusSite:function(){if(""!==m_cLatLng&&m_cLatLng){var t=m_cLatLng.split(",");if(t&&2==t.length){var e=a.latLng(t[1],t[0]);this.drawLayers({oLatLng:e})}}}}),ES.TrackView.WorkUnloadLayer=ES.TrackView.UnloadLayer.extend({initialize:function(t,e){ES.TrackView.UnloadLayer.prototype.initialize.call(this,t,{}),this.initUI()},initUI:function(){var t=this._oParent.getUnloadId();t&&ES.Util.reqData({data:{anId:[t]},url:"/Unload/GetUnloadByIds"},function(t){this.drawLayer(t)},this)},_loadOn:function(){},drawLayer:function(t,e){if(t&&t.rtnData&&!(t.rtnData.length<=0)){var i=t.rtnData[0],r=this.createLayer(i,e);if(r){r.cId=i.Id;var n=ES.Util.template(this.cHtml,i),o=this._getIcon(n),s=a.marker(r.getCenter(),{icon:o});s.addTo(this._oPolylineGroup),r.oMarker=s}}},createLayer:function(t,e){var i=this.findLayer(this._oPolylineGroup,t.Id);return i||(t&&t.Points?i=a.polygon(t.Points,this.oOption.oStyleConfig).addTo(this._oPolylineGroup):i)}})}(window,document,L,jQuery);